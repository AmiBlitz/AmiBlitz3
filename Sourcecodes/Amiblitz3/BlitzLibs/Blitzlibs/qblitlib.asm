; IRA V2.10 (04.12.23) (c)1993-1995 Tim Ruehsen
; (c)2009-2015 Frank Wille, (c)2014-2019 Nicolas Bastien




	SECTION S_0,CODE

SECSTRT_0:
	MOVEQ	#0,D0			;000: 7000
	RTS				;002: 4e75
	DC.L	$00940000		;004
	DS.L	3			;008
	DS.W	1			;014
	DC.L	LAB_0002		;016: 000001c2
	DS.L	4			;01a
	DS.W	1			;02a
	DC.L	LAB_0030		;02c: 00000542

	DC.L	$00010000,$00000002,$02020094,$13800000 ;030
	DS.L	1			;040
	DC.L	LAB_000B		;044: 0000025a
	DS.L	1			;048
	DC.L	$ffff0000		;04c
	DS.L	1			;050
LAB_0001:
	DC.B	"Queue",0
	DC.B	"Queue#,Max Items",0,0

	DC.L	$00010000,$00000004,$02020202,$009a1381 ;06c
	DC.L	$00941080,$00a01202,$fa641100,$00fe5600 ;07c
	DS.W	1			;08c
	DC.L	LAB_0048		;08e: 000006c6
	DC.L	LAB_0029		;092: 00000468
	DS.L	1			;096
	DC.L	$00050202,$02020200,$009a1381,$00941080 ;09a
	DC.L	$00a01202,$fa641100,$00fe5600 ;0aa
	DS.W	1			;0b6
	DC.L	LAB_0048		;0b8: 000006c6
	DC.L	LAB_000E		;0bc: 00000292
	DS.L	1			;0c0
	DC.L	$ffff0000		;0c4
	DS.L	1			;0c8
	DC.B	"QBlit",0
	DC.B	"Queue#,Shape#,X,Y[,Excessonoff]",0

	DC.L	$00010000,$00000001,$02000094,$1380fa64 ;0f2
	DC.L	$110000fe,$56000000	;102
	DC.L	LAB_0046		;10a: 000006ae
	DC.L	LAB_001F		;10e: 000003ca
	DS.L	1			;112
	DC.L	$00020202,$00941380,$fa641100,$00fe5600 ;116
	DC.L	$00a01281		;126
	DS.W	1			;12a
	DC.L	LAB_0047		;12c: 000006b8
	DC.L	LAB_0015		;130: 00000310
	DS.L	1			;134
	DC.L	$ffff0000		;138
	DS.L	1			;13c
	DC.B	"UnQueue",0
	DC.B	"Queue#[,BitMap#]",0,0

	DC.L	$00010000,$00000001,$02000000 ;15a
	DS.L	1			;166
	DC.L	LAB_0009		;16a: 00000248
	DS.L	1			;16e
	DC.L	$ffff0000		;172
	DS.L	1			;176
	DC.B	"QBlitMode",0
	DC.B	"BLTCON0",0

	DC.L	$00010000,$00000001,$02000094,$13800000 ;18c
	DC.L	LAB_0046		;19c: 000006ae
	DC.L	LAB_000A		;1a0: 00000250
	DS.L	1			;1a4
	DC.L	$ffff0000		;1a8
	DS.L	1			;1ac
	DC.B	"FlushQueue",0
	DC.B	"Queue#",0

LAB_0002:
	DS.L	3			;1c2
	DC.L	LAB_0008		;1ce: 00000244
	DS.L	1			;1d2
LAB_0003:
	DS.L	5			;1d6
LAB_0004:
	DS.L	5			;1ea
LAB_0005:
	DS.L	5			;1fe
LAB_0006:
	DS.L	3			;212
	DC.L	LAB_000C		;21e: 00000278
	DS.L	1			;222
	DC.W	$ffff			;226
	DC.L	LAB_0001		;228: 00000054
	DC.L	LAB_0003		;22c: 000001d6
	DC.L	LAB_0004		;230: 000001ea
	DC.L	LAB_0005		;234: 000001fe
	DC.L	LAB_0006		;238: 00000212
	DC.L	$0000000a		;23c
	DC.W	$0004			;240

LAB_0007:
	DC.W	$0fca			;242
LAB_0008:
	MOVE.W	#$0fca,D0		;244: 303c0fca
LAB_0009:
	MOVE.W	D0,LAB_0007		;248: 33c000000242
	RTS				;24e: 4e75
LAB_000A:
	DC.W	$a000			;250
	DC.W	$0004			;252
	MOVE.L	4(A3),(A3)		;254: 26ab0004
	RTS				;258: 4e75

LAB_000B:
	MOVE.W	D1,D2			;25a: 3401
	BSR.W	LAB_000C		;25c: 6100001a
	MOVE.W	D2,D0			;260: 3002
	DC.W	$c0fc			;262
	DC.W	$000e			;264
	MOVEQ	#1,D1			;266: 7201
	MOVE.L	D0,8(A3)		;268: 27400008
	JSR	SECSTRT_0-2147434494	;26c: 4eb98000c002
	MOVE.L	D0,(A3)+		;272: 26c0
	MOVE.L	D0,(A3)			;274: 2680
RTS

LAB_000C:
	MOVE.L	4(A3),D0		;278: 202b0004
	BEQ.W	LAB_000D		;27c: 67000012
	MOVEA.L	D0,A1			;280: 2240
	MOVE.L	8(A3),D0		;282: 202b0008
	DC.W	$4eb9			;286
	DC.L	SECSTRT_0-2147434493	;288: 8000c003
	CLR.L	4(A3)			;28c: 42ab0004
LAB_000D:
RTS

LAB_000E:
	DC.W	$a001			;292
	DC.L	LAB_0010		;294: 000002bc
	MOVEM.L	D1/A0-A1,-(A7)		;298: 48e740c0
	JSR	-456(A6)		;29c: 4eaefe38
	MOVEM.L	(A7)+,D1/A0-A1		;2a0: 4cdf0302
	BSR.W	LAB_0010		;2a4: 61000016
	BTST	#6,2(A1)		;2a8: 082900060002
LAB_000F:
	BTST	#6,2(A1)		;2ae: 082900060002
	BNE.W	LAB_000F		;2b4: 6600fff8
JMP	-462(A6)

LAB_0010:
	MOVE.W	D4,-(A7)		;2bc: 3f04
	BSR.W	LAB_002B		;2be: 610001d2
	MOVE.W	4(A3),D7		;2c2: 3e2b0004
	MOVE.W	(A7)+,D2		;2c6: 341f
LAB_0011:
	DC.W	$be6a			;2c8
	DC.W	$0004			;2ca
	BCC.W	LAB_0014		;2cc: 64000040
	MOVE.W	#$0b0a,D5		;2d0: 3a3c0b0a
	LSR.W	#1,D2			;2d4: e24a
	BCC.W	LAB_0012		;2d6: 64000006
	MOVE.W	#$0bfa,D5		;2da: 3a3c0bfa
LAB_0012:
	OR.W	D4,D5			;2de: 8a44
	MOVE.L	(A0)+,D1		;2e0: 2218
	ADD.L	D3,D1			;2e2: d283
	BTST	#6,2(A1)		;2e4: 082900060002
LAB_0013:
	BTST	#6,2(A1)		;2ea: 082900060002
	BNE.W	LAB_0013		;2f0: 6600fff8
	MOVE.W	D5,64(A1)		;2f4: 33450040
	MOVE.L	D0,80(A1)		;2f8: 23400050
	MOVE.L	D1,72(A1)		;2fc: 23410048
	MOVE.L	D1,84(A1)		;300: 23410054
	MOVE.W	D6,88(A1)		;304: 33460058
	ADDQ.W	#1,D7			;308: 5247
	BRA.W	LAB_0011		;30a: 6000ffbc
LAB_0014:
RTS

LAB_0015:
	DC.W	$a001			;310
	DC.L	LAB_0017		;312: 00000336
	MOVE.L	A1,-(A7)		;316: 2f09
	JSR	-456(A6)		;318: 4eaefe38
	MOVEA.L	(A7)+,A1		;31c: 225f
	BSR.W	LAB_0017		;31e: 61000016
	BTST	#6,2(A1)		;322: 082900060002
LAB_0016:
	BTST	#6,2(A1)		;328: 082900060002
	BNE.W	LAB_0016		;32e: 6600fff8
JMP	-462(A6)

LAB_0017:
	MOVEM.L	A4-A5,-(A7)		;336: 48e7000c
	BTST	#6,2(A1)		;33a: 082900060002
LAB_0018:
	BTST	#6,2(A1)		;340: 082900060002
	BNE.W	LAB_0018		;346: 6600fff8
	MOVE.L	#$09f00000,64(A1)	;34a: 237c09f000000040
	MOVE.L	#$ffffffff,68(A1)	;352: 237cffffffff0044
	MOVEA.L	(A3)+,A0		;35a: 205b
	MOVEA.L	(A3),A4			;35c: 2853
	MOVE.L	A4,-(A3)		;35e: 270c
	DC.W	$b9c8			;360
	BCC.W	LAB_001E		;362: 64000060
	BRA.W	LAB_001B		;366: 60000018
LAB_0019:
	DC.W	$b9c8			;36a
	BCC.W	LAB_001E		;36c: 64000056
	BTST	#6,2(A1)		;370: 082900060002
LAB_001A:
	BTST	#6,2(A1)		;376: 082900060002
	BNE.W	LAB_001A		;37c: 6600fff8
LAB_001B:
	MOVE.W	(A4),102(A1)		;380: 33540066
	MOVE.W	(A4)+,100(A1)		;384: 335c0064
	MOVE.W	(A4)+,D7		;388: 3e1c
	MOVE.W	(A4)+,D6		;38a: 3c1c
	MOVEA.L	(A4)+,A3		;38c: 265c
	MOVE.L	(A4)+,D0		;38e: 201c
	LEA	8(A3),A3		;390: 47eb0008
	LEA	8(A2),A5		;394: 4bea0008
LAB_001C:
	BTST	#6,2(A1)		;398: 082900060002
LAB_001D:
	BTST	#6,2(A1)		;39e: 082900060002
	BNE.W	LAB_001D		;3a4: 6600fff8
	MOVE.L	(A3)+,D1		;3a8: 221b
	ADD.L	D0,D1			;3aa: d280
	MOVE.L	D1,84(A1)		;3ac: 23410054
	MOVE.L	(A5)+,D1		;3b0: 221d
	ADD.L	D0,D1			;3b2: d280
	MOVE.L	D1,80(A1)		;3b4: 23410050
	MOVE.W	D7,88(A1)		;3b8: 33470058
	DBF	D6,LAB_001C		;3bc: 51ceffda
	BRA.W	LAB_0019		;3c0: 6000ffa8
LAB_001E:
	MOVEM.L	(A7)+,A4-A5		;3c4: 4cdf3000
	RTS				;3c8: 4e75
LAB_001F:
	DC.W	$a001			;3ca
	DC.L	LAB_0021		;3cc: 000003f0
	MOVE.L	A1,-(A7)		;3d0: 2f09
	JSR	-456(A6)		;3d2: 4eaefe38
	MOVEA.L	(A7)+,A1		;3d6: 225f
	BSR.W	LAB_0021		;3d8: 61000016
	BTST	#6,2(A1)		;3dc: 082900060002
LAB_0020:
	BTST	#6,2(A1)		;3e2: 082900060002
	BNE.W	LAB_0020		;3e8: 6600fff8
	JMP	-462(A6)		;3ec: 4eeefe32
LAB_0021:
	BTST	#6,2(A1)		;3f0: 082900060002
LAB_0022:
	BTST	#6,2(A1)		;3f6: 082900060002
	BNE.W	LAB_0022		;3fc: 6600fff8
	MOVE.L	#$01f00000,64(A1)	;400: 237c01f000000040
	CLR.W	116(A1)			;408: 42690074
	MOVEA.L	(A3)+,A0		;40c: 205b
	MOVEA.L	(A3),A2			;40e: 2453
	MOVE.L	A2,-(A3)		;410: 270a
	DC.W	$b5c8			;412
	BCC.W	LAB_0028		;414: 64000050
	BRA.W	LAB_0025		;418: 60000018
LAB_0023:
	DC.W	$b5c8			;41c
	BCC.W	LAB_0028		;41e: 64000046
	BTST	#6,2(A1)		;422: 082900060002
LAB_0024:
	BTST	#6,2(A1)		;428: 082900060002
	BNE.W	LAB_0024		;42e: 6600fff8
LAB_0025:
	MOVE.W	(A2)+,102(A1)		;432: 335a0066
	MOVE.W	(A2)+,D7		;436: 3e1a
	MOVE.W	(A2)+,D6		;438: 3c1a
	MOVEA.L	(A2)+,A3		;43a: 265a
	MOVE.L	(A2)+,D0		;43c: 201a
	LEA	8(A3),A3		;43e: 47eb0008
LAB_0026:
	BTST	#6,2(A1)		;442: 082900060002
LAB_0027:
	BTST	#6,2(A1)		;448: 082900060002
	BNE.W	LAB_0027		;44e: 6600fff8
	MOVE.L	(A3)+,D1		;452: 221b
	ADD.L	D0,D1			;454: d280
	MOVE.L	D1,84(A1)		;456: 23410054
	MOVE.W	D7,88(A1)		;45a: 33470058
	DBF	D6,LAB_0026		;45e: 51ceffe2
	BRA.W	LAB_0023		;462: 6000ffb8
LAB_0028:
	RTS				;466: 4e75
LAB_0029:
	DC.W	$a001			;468
	DC.L	LAB_002B		;46a: 00000492
	MOVEM.L	D1/A0-A1,-(A7)		;46e: 48e740c0
	JSR	-456(A6)		;472: 4eaefe38
	MOVEM.L	(A7)+,D1/A0-A1		;476: 4cdf0302
	BSR.W	LAB_002B		;47a: 61000016
	BTST	#6,2(A1)		;47e: 082900060002
LAB_002A:
	BTST	#6,2(A1)		;484: 082900060002
	BNE.W	LAB_002A		;48a: 6600fff8
JMP	-462(A6)

LAB_002B:
	SUB.W	10(A3),D2		;492: 946b000a
	SUB.W	12(A3),D3		;496: 966b000c
	MOVE.L	A4,-(A7)		;49a: 2f0c
	MOVEA.L	(A0),A4			;49c: 2850
	MOVEQ	#-2,D7			;49e: 7efe
	SWAP	D7			;4a0: 4847
	MOVE.W	(A2),D7			;4a2: 3e12
	SUB.W	6(A3),D7		;4a4: 9e6b0006
	SUBQ.W	#2,D7			;4a8: 5547
	MOVE.W	D7,(A4)+		;4aa: 38c7
	MOVE.L	D7,D6			;4ac: 2c07
	SWAP	D6			;4ae: 4846
	BTST	#6,2(A1)		;4b0: 082900060002
LAB_002C:
	BTST	#6,2(A1)		;4b6: 082900060002
	BNE.W	LAB_002C		;4bc: 6600fff8
	MOVEM.L	D6-D7,96(A1)		;4c0: 48e900c00060
	MOVE.W	D2,D0			;4c6: 3002
	DC.W	$c07c			;4c8
	DC.W	$000f			;4ca
	ROR.W	#4,D0			;4cc: e858
	MOVE.W	D0,D4			;4ce: 3800
	MOVE.W	D0,66(A1)		;4d0: 33400042
	OR.W	LAB_0007(PC),D0		;4d4: 807afd6c
	MOVE.W	D0,64(A1)		;4d8: 33400040
	MOVE.L	#$ffff0000,68(A1)	;4dc: 237cffff00000044
	MOVE.L	14(A3),76(A1)		;4e4: 236b000e004c
	MOVE.L	18(A3),D0		;4ea: 202b0012
	DC.W	$c7d2			;4ee
	ASR.W	#3,D2			;4f0: e642
	EXT.L	D2			;4f2: 48c2
	ADD.L	D2,D3			;4f4: d682
	MOVE.W	4(A3),D7		;4f6: 3e2b0004
	SUBQ.W	#1,D7			;4fa: 5347
	MOVE.W	8(A3),D6		;4fc: 3c2b0008
	MOVE.W	D6,(A4)+		;500: 38c6
	MOVE.W	4(A2),(A4)		;502: 38aa0004
	SUBQ.W	#1,(A4)+		;506: 535c
	MOVE.L	A2,(A4)+		;508: 28ca
	MOVE.L	D3,(A4)+		;50a: 28c3
	MOVE.L	A4,(A0)			;50c: 208c
	LEA	8(A2),A0		;50e: 41ea0008
	BRA.W	LAB_002F		;512: 60000012
LAB_002D:
	BTST	#6,2(A1)		;516: 082900060002
LAB_002E:
	BTST	#6,2(A1)		;51c: 082900060002
	BNE.W	LAB_002E		;522: 6600fff8
LAB_002F:
	MOVE.L	D0,80(A1)		;526: 23400050
	MOVE.L	(A0)+,D1		;52a: 2218
	ADD.L	D3,D1			;52c: d283
	MOVE.L	D1,72(A1)		;52e: 23410048
	MOVE.L	D1,84(A1)		;532: 23410054
	MOVE.W	D6,88(A1)		;536: 33460058
	DBF	D7,LAB_002D		;53a: 51cfffda
	MOVEA.L	(A7)+,A4		;53e: 285f
RTS

; ---------------------------- error handling

LAB_0030: MOVE.L	#LAB_0033,D0 : TRAP	#0
LAB_0031: MOVE.L	#LAB_0034,D0 : TRAP	#0
LAB_0032: MOVE.L	#LAB_0035,D0 : TRAP	#0

LAB_0033: DC.B	"Uninitialized Queue",0
LAB_0034: DC.B	"Uninitialized BitMap",0
LAB_0035: DC.B	"Queue Overflow",0

LAB_0036: MOVE.L	#LAB_003B,D0 : TRAP	#0
LAB_0037: MOVE.L	#LAB_003C,D0 : TRAP	#0
LAB_0038: MOVE.L	#LAB_003D,D0 : TRAP	#0
LAB_0039: MOVE.L	#LAB_003E,D0 : TRAP	#0
LAB_003A: MOVE.L	#LAB_003F,D0 : TRAP	#0

LAB_003B: DC.B	"Shape has too many BitPlanes",0
LAB_003C: DC.B	"Unitialized BitMap",0
LAB_003D: DC.B	"Uninialized Shape",0
LAB_003E: DC.B	"Shape does not have a cookie cut",0
LAB_003F: DC.B	"Coords outside of BitMap",0


LAB_0040:
	TST.L	18(A3) : BEQ.W	LAB_0039
LAB_0041:
	TST.W	62(A2) : BEQ.W	LAB_0037
	TST.W	(A3)   : BEQ.W	LAB_0038
RTS

LAB_0042:
	BSR.W	LAB_0040		;64e: 6100ffe6
	MOVE.W	D2,D6			;652: 3c02
	MOVE.W	D3,D7			;654: 3e03
	BRA.W	LAB_0044		;656: 6000001e
	BSR.W	LAB_0041		;65a: 6100ffe2
	BRA.W	LAB_0043		;65e: 60000012
	BSR.W	LAB_0040		;662: 6100ffd2
	MOVE.W	D1,D6			;666: 3c01
	MOVE.W	D2,D7			;668: 3e02
	BRA.W	LAB_0045		;66a: 60000016
	BSR.W	LAB_0040		;66e: 6100ffc6
LAB_0043:
	MOVE.W	D1,D6			;672: 3c01
	MOVE.W	D2,D7			;674: 3e02
LAB_0044:
	MOVE.W	4(A3),D5		;676: 3a2b0004
	DC.W	$ba6a			;67a
	DC.W	$0004			;67c
	BHI.W	LAB_0036		;67e: 6200ff12
LAB_0045:
	SUB.W	10(A3),D6		;682: 9c6b000a
	SUB.W	12(A3),D7		;686: 9e6b000c
	TST.W	D6			;68a: 4a46
	BMI.W	LAB_003A		;68c: 6b00ff24
	TST.W	D7			;690: 4a47
	BMI.W	LAB_003A		;692: 6b00ff1e
	ADD.W	(A3),D6			;696: dc53
	DC.W	$bc6a			;698
	DC.W	$0038			;69a
	BHI.W	LAB_003A		;69c: 6200ff14
	ADD.W	2(A3),D7		;6a0: de6b0002
	DC.W	$be6a			;6a4
	DC.W	$003a			;6a6
	BHI.W	LAB_003A		;6a8: 6200ff08
RTS				;6ac: 4e75

LAB_0046:
	TST.L	4(A3) : BEQ.W	LAB_0030
RTS

LAB_0047:
	BSR.W	LAB_0046
	TST.W	62(A2) : BEQ.W	LAB_0031
RTS

LAB_0048:
	TST.L	4(A0) : BEQ.W	LAB_0030
	BSR.W	LAB_0042
	MOVE.L	4(A0),D7
	ADD.L	8(A0),D7
	MOVE.L	(A0),D6
	ADDI.L	#$0000000e,D6
	DC.W	$bc87 :	BHI.W	LAB_0032
RTS