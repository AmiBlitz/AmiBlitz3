; XTRA
; Embedded .xtra Header
; 
; General Info
; -------------------------------------------------------
; ExePath         = "Blitz3:BlitzLibs/Decompiled/baselibs"
; ExeFile         = "scrolllib.obj_new"
; CreateIcon      = 0
; Residents       = "libmacs.res,libnums.res,libjsrs.res,LVO.res"
; 
; Compiler
; -------------------------------------------------------
; StringBuffer    = 10240
; MakeSmallest    = 1
; FuncOptimize    = 1
; Version         = 0.0.0
; NumberOfBuilds  = 7
; 
; Debugger
; -------------------------------------------------------
; CliArgs         = ""
; StackSize       = 32768
; RuntimeDebug    = 0
; DebugInfo       = 0
; CreateDbgFile   = 0
; OverflowCheck   = 0
; AssemblerCheck  = 1
; InterruptCheck  = 1
; AutoRun         = 1
; 
; Editor
; -------------------------------------------------------
; CursorLine      = 144
; CursorColumn    = 20
; LabelSearch     = ""
; LabelRemark     = 0
; LabelAll        = 0
; LabelCase       = 0
; LabelPosition   = 0
; 
; Blitz Objects
; -------------------------------------------------------
; Max File        = 5
; Max GadgetList  = 5
; Max Shape       = 100
; Max Bank        = 5
; Max MenuList    = 5
; Max GTList      = 20
; Max BitMap      = 10
; Max Screen      = 5
; Max IntuiFont   = 5
; Max Window      = 20
; Max BlitzFont   = 4
; Max Palette     = 32
; Max IconInfo    = 1
; Max MUIObject   = 50
; Max AsyncReq    = 4
; Max Req-Lib     = 5
; Max GTMenuList  = 5
; Max Console     = 5
; Max TCPSock     = 5
; Max Tape        = 5
; Max TagList     = 5
; Max Database    = 16
; Max Sound       = 10
; Max MedModule   = 8
; Max Buffer      = 10
; Max Queue       = 10
; Max Sprite      = 20
; Max Module      = 5
; Max Slice       = 10
; Max Page        = 4
; Max CopList     = 10
; Max PTModule    = 5
; Max Anim        = 10
; Max NChunky     = 50
; Max Chunky      = 20
; Max Stencil     = 5
; Max XBSound     = 10
; /XTRA
; XTRA
; Embedded .xtra Header
; 
; General Info
; -------------------------------------------------------
; ExePath         = "Blitz3:BlitzLibs/Decompiled/baselibs"
; ExeFile         = "scrolllib.obj_new"
; CreateIcon      = 0
; Residents       = "libmacs.res,libnums.res,libjsrs.res"
; 
; Compiler
; -------------------------------------------------------
; StringBuffer    = 10240
; MakeSmallest    = 1
; FuncOptimize    = 1
; Version         = 0.0.0
; NumberOfBuilds  = 3
; 
; Debugger
; -------------------------------------------------------
; CliArgs         = ""
; StackSize       = 32768
; RuntimeDebug    = 0
; DebugInfo       = 0
; CreateDbgFile   = 0
; OverflowCheck   = 0
; AssemblerCheck  = 1
; InterruptCheck  = 1
; AutoRun         = 1
; 
; Editor
; -------------------------------------------------------
; CursorLine      = 80
; CursorColumn    = 14
; LabelSearch     = ""
; LabelRemark     = 0
; LabelAll        = 0
; LabelCase       = 0
; LabelPosition   = 0
; 
; Blitz Objects
; -------------------------------------------------------
; Max File        = 5
; Max GadgetList  = 5
; Max Shape       = 100
; Max Bank        = 5
; Max MenuList    = 5
; Max GTList      = 20
; Max BitMap      = 10
; Max Screen      = 5
; Max IntuiFont   = 5
; Max Window      = 20
; Max BlitzFont   = 4
; Max Palette     = 32
; Max IconInfo    = 1
; Max MUIObject   = 50
; Max AsyncReq    = 4
; Max Req-Lib     = 5
; Max GTMenuList  = 5
; Max Console     = 5
; Max TCPSock     = 5
; Max Tape        = 5
; Max TagList     = 5
; Max Database    = 16
; Max Sound       = 10
; Max MedModule   = 8
; Max Buffer      = 10
; Max Queue       = 10
; Max Sprite      = 20
; Max Module      = 5
; Max Slice       = 10
; Max Page        = 4
; Max CopList     = 10
; Max PTModule    = 5
; Max Anim        = 10
; Max NChunky     = 50
; Max Chunky      = 20
; Max Stencil     = 5
; Max XBSound     = 10
!libheader{#scrolllib,init,0,0,errors}

!astatement
!args{#word,#word,#word|#push,#word|#push,#word,#word}
!libs{#bitmaplib,#ua3,#bitmaplib,#ua0,#chipbaselib,#la1,#graphicslib,$4600}
!subs{do_Scroll,chkXY,0}
!args{#word,#word,#word|#push,#word|#push,#word,#word,#word}
!libs{#bitmaplib,#ua3,#bitmaplib,#ia0|pd4,#chipbaselib,#la1,#graphicslib,$4600}
!subs{do_Scroll,chkXYBitmap,0}
!name{"Scroll","X1,Y1,Width,Height,X2,Y2[,BitMap#]"}

!nullsub{blitzScroll,0,0}

!astatement
!args{#word,#word,#word}
!libs{#bitmaplib,#ua2}
!subs{do_Plot,chkBitMap,0}
!name{"Plot","X,Y,Colour"}

!afunction{#word}
!args{#word,#word}
!libs{#bitmaplib,#ua2}
!subs{do_Point,chkBitMap,0}
!name{"Point","X,Y,Colour"}

!astatement
!args
!libs{#bitmaplib,#ua2,#chipbaselib,#la1,#graphicslib,$5600}
!subs{do_Cls,chkBitMap,0}
!args{#word}
!libs{#bitmaplib,#ua2,#chipbaselib,#la1,#graphicslib,$5600}
!subs{do_ClsX,chkBitMap,0}
!name{"Cls","[Colour]"}

!astatement
!args{#word,#word,#word|#push,#word|#push,#word,#word}
!libs{#bitmaplib,#ua3,#bitmaplib,#ua0,#chipbaselib,#la1,#graphicslib,$4600}
!subs{do_BlockScroll,chkXY,0}
!args{#word,#word,#word|#push,#word|#push,#word,#word,#word}
!libs{#bitmaplib,#ua3,#bitmaplib,$1084,#chipbaselib,#la1,#graphicslib,$4600}
!subs{do_BlockScroll,chkXYBitmap,0}
!name{"BlockScroll","X1,Y1,Width,Height,X2,Y2[,BitMap#]"}

init: !nullsub{codeinit,0,0}

!libfin


LAB_0002: Ds.l 1   ;232
LAB_0003: Ds.w 1   ;236
LAB_0004: Dc.l $0fe20000  ;238
          Ds.w 1   ;23c

.do_Cls:
  Dc.w $a001 : Dc.l blitz_cls0

  MOVE.l A1,-(A7)
  JSR _OwnBlitter(A6)
  MOVEA.l (A7)+,A1

  BSR.w blitz_cls0

  BTST #6,2(A1)
  LAB_0006:
    BTST #6,2(A1)
  BNE.w LAB_0006
JMP _DisownBlit(A6)

.do_ClsX:
  Dc.w $a001 : Dc.l blitz_clsX

  MOVEM.l D0/A1,-(A7)
  JSR _OwnBlitter(A6)
  MOVEM.l (A7)+,D0/A1

  BSR.w blitz_clsX

  BTST #6,2(A1)
  LAB_0008:
    BTST #6,2(A1)
  BNE.w LAB_0008
JMP _DisownBlit(A6)

blitz_cls0:
  MOVEQ #0,D0

  blitz_clsX:
  BTST #6,2(A1)
  LAB_000B:
    BTST #6,2(A1)
  BNE.w LAB_000B

  MOVE.l #$01f00000,64(A1)
  MOVE.l #$ffffffff,68(A1)
  TST.w 52(A2) : BPL.w LAB_000F

  MOVEQ #0,D4   ;2b8: 7800
  MOVE.w 58(A2),D7  ;2ba: 3e2a003a
  LAB_000C:
    MOVE.w #$0400,D2  ;2be: 343c0400
    CMP.w D2,D7 : BLE.w LAB_000D  ;2c4: 6f00001c
      BSR.w LAB_0019
      SUBI.w #$0400,D7 : BEQ.w LAB_000E  ;1024
      MOVEQ #0,D6   ;2d4: 7c00
      MOVE.w (A2),D6   ;2d6: 3c12
      LSL.l #8,D6   ;2d8: e18e
      LSL.l #2,D6   ;2da: e58e
      ADD.l D6,D4   ;2dc: d886
  BRA.w LAB_000C  ;2de: 6000ffde
  LAB_000D:
  MOVE.w D7,D2   ;2e2: 3407
  BRA.w LAB_0019  ;2e4: 600000ae
  LAB_000E:
RTS

LAB_000F:
 MOVE.w (A2),D1   ;2ea: 3212
 MULU 58(A2),D1  ;2ec: c2ea003a
 MOVE.w 4(A2),D2  ;2f0: 342a0004
 SUBQ.w #1,D2   ;2f4: 5342
 ADDQ.w #8,A2   ;2f6: 504a
 MOVE.w #$0000,102(A1)  ;2f8: 337c00000066
LAB_0010:
  LSR.w #1,D0   ;2fe: e248
  SCS D3   ;300: 55c3
  EXT.w D3   ;302: 4883
  MOVE.l D1,D4   ;304: 2801
  BTST #6,2(A1)  ;306: 082900060002
  LAB_0011:
    BTST #6,2(A1)  ;30c: 082900060002
  BNE.w LAB_0011  ;312: 6600fff8
  MOVE.w D3,116(A1)  ;316: 33430074
  MOVE.l (A2)+,84(A1)  ;31a: 235a0054
  LAB_0012:
  CMPI.l #$00020000,D4  ;31e: 0c8400020000
  BLT.w LAB_0014  ;324: 6d000022

  BTST #6,2(A1)  ;328: 082900060002
  LAB_0013:
    BTST #6,2(A1)  ;32e: 082900060002
  BNE.w LAB_0013  ;334: 6600fff8

  MOVE.w #$0000,88(A1)  ;338: 337c00000058
  SUBI.l #$00020000,D4  ;33e: 048400020000
  BRA.w LAB_0012  ;344: 6000ffd8
LAB_0014:
  MOVE.l D4,D3   ;348: 2604
  BEQ.w LAB_0018  ;34a: 67000042
  LSR.l #1,D3   ;34e: e28b
  AND.w #$ffc0,D3  ;350: c67cffc0
  BEQ.w LAB_0016  ;354: 6700001e
  BTST #6,2(A1)  ;358: 082900060002
  LAB_0015:
  BTST #6,2(A1)  ;35e: 082900060002
  BNE.w LAB_0015  ;364: 6600fff8
  MOVE.w D3,88(A1)  ;368: 33430058
  ADD.l D3,D3   ;36c: d683
  SUB.l D3,D4   ;36e: 9883
  BEQ.w LAB_0018  ;370: 6700001c
  LAB_0016:
  LSR.l #1,D4   ;374: e28c
  ORI.w #$0040,D4  ;376: 00440040
  BTST #6,2(A1)  ;37a: 082900060002
  LAB_0017:
  BTST #6,2(A1)  ;380: 082900060002
  BNE.w LAB_0017  ;386: 6600fff8
  MOVE.w D4,88(A1)  ;38a: 33440058
  LAB_0018:
  DBF D2,LAB_0010  ;38e: 51caff6e
RTS    ;392: 4e75

LAB_0019:
 MOVE.l D4,-(A7)  ;394: 2f04
 LSL.w #6,D2   ;396: ed4a
 MOVE.w 54(A2),D6  ;398: 3c2a0036
LAB_001A:
 MOVE.w (A2),D3   ;39c: 3612
 CMPI.w #$0080,D6  ;39e: 0c460080
 BLE.w LAB_001B  ;3a2: 6f00001c
 SUBI.w #$0080,D3  ;3a6: 04430080
 BSR.w LAB_001C  ;3aa: 61000022
 ADDI.l #$00000080,D4  ;3ae: 068400000080
 SUBI.w #$0080,D6  ;3b4: 04460080
 BNE.w LAB_001A  ;3b8: 6600ffe2
 MOVE.l (A7)+,D4  ;3bc: 281f
 RTS    ;3be: 4e75
LAB_001B:
 SUB.w D6,D3   ;3c0: 9646
 LSR.w #1,D6   ;3c2: e24e
 OR.w D6,D2   ;3c4: 8446
 BSR.w LAB_001C  ;3c6: 61000006
 MOVE.l (A7)+,D4  ;3ca: 281f
 RTS    ;3cc: 4e75
LAB_001C:
 MOVE.w D0,D1   ;3ce: 3200
 MOVE.w 4(A2),-(A7)  ;3d0: 3f2a0004
 LEA 8(A2),A0  ;3d4: 41ea0008
LAB_001D:
 LSR.w #1,D1   ;3d8: e249
 SCS D5   ;3da: 55c5
 EXT.w D5   ;3dc: 4885
 BTST #6,2(A1)  ;3de: 082900060002
LAB_001E:
 BTST #6,2(A1)  ;3e4: 082900060002
 BNE.w LAB_001E  ;3ea: 6600fff8
 MOVE.w D5,116(A1)  ;3ee: 33450074
 MOVE.l (A0)+,D5  ;3f2: 2a18
 ADD.l D4,D5   ;3f4: da84
 MOVE.l D5,84(A1)  ;3f6: 23450054
 MOVE.w D3,102(A1)  ;3fa: 33430066
 MOVE.w D2,88(A1)  ;3fe: 33420058
 SUBQ.w #1,(A7)   ;402: 5357
 BNE.w LAB_001D  ;404: 6600ffd2
 ADDQ.w #2,A7   ;408: 544f
RTS    ;40a: 4e75

.do_Plot:
 ADD.w 48(A2),D0  ;40c: d06a0030
 ADD.w 50(A2),D1  ;410: d26a0032
 CMP.w 56(A2),D0  ;414: b06a0038
 BCC.w LAB_0022  ;418: 64000038
 CMP.w 58(A2),D1  ;41c: b26a003a
 BCC.w LAB_0022  ;420: 64000030
 MULU (A2),D1   ;424: c2d2
 MOVEQ #0,D3   ;426: 7600
 MOVE.w D0,D3   ;428: 3600
 LSR.w #3,D3   ;42a: e64b
 ADD.l D3,D1   ;42c: d283
 NOT.w D0   ;42e: 4640
 LEA 8(A2),A0  ;430: 41ea0008
 MOVE.w 4(A2),D3  ;434: 362a0004
 SUBQ.w #1,D3   ;438: 5343
 TST.w D2   ;43a: 4a42
 BMI.w LAB_0023  ;43c: 6b000016
LAB_0020:
 MOVEA.l (A0)+,A1  ;440: 2258
 ADDA.l D1,A1   ;442: d3c1
 BCLR D0,(A1)   ;444: 0191
 LSR.w #1,D2   ;446: e24a
 BCC.w LAB_0021  ;448: 64000004
 BSET D0,(A1)   ;44c: 01d1
LAB_0021:
 DBF D3,LAB_0020  ;44e: 51cbfff0
LAB_0022:
 RTS    ;452: 4e75
LAB_0023:
 MOVEA.l (A0)+,A1  ;454: 2258
 BCHG D0,0(A1,D1.l)  ;456: 01711800
 DBF D3,LAB_0023  ;45a: 51cbfff8
RTS    ;45e: 4e75

.do_Point:
 ADD.w 48(A2),D0  ;460: d06a0030
 ADD.w 50(A2),D1  ;464: d26a0032
 CMP.w 56(A2),D0  ;468: b06a0038
 BCC.w LAB_0027  ;46c: 64000038
 CMP.w 58(A2),D1  ;470: b26a003a
 BCC.w LAB_0027  ;474: 64000030
 MULU (A2),D1   ;478: c2d2
 MOVEQ #0,D3   ;47a: 7600
 MOVE.w D0,D3   ;47c: 3600
 LSR.w #3,D3   ;47e: e64b
 ADD.l D3,D1   ;480: d283
 NOT.w D0   ;482: 4640
 LEA 8(A2),A0  ;484: 41ea0008
 MOVEQ #0,D3   ;488: 7600
 MOVEQ #0,D2   ;48a: 7400
LAB_0025:
 MOVEA.l (A0)+,A1  ;48c: 2258
 BTST D0,0(A1,D1.l)  ;48e: 01311800
 BEQ.w LAB_0026  ;492: 67000004
 BSET D3,D2   ;496: 07c2
LAB_0026:
 ADDQ.w #1,D3   ;498: 5243
 CMP.w 4(A2),D3  ;49a: b66a0004
 BCS.w LAB_0025  ;49e: 6500ffec
 MOVE.w D2,D0   ;4a2: 3002
 RTS    ;4a4: 4e75
LAB_0027:
 MOVEQ #0,D0   ;4a6: 7000
 RTS    ;4a8: 4e75

.codeinit:
  MOVE.l #$00000090,D0  ;144
  MOVEQ #2,D1
  ALibJsr #globalalloc
  MOVEA.l D0,A0
  MOVE.l D0,LAB_0002
  MOVEQ #35,D0
  MOVEQ #-1,D1
  LAB_0029:
    MOVE.l D1,(A0)+
  DBF D0,LAB_0029
  CLR.w LAB_0003
RTS

.do_Scroll:
  Dc.w $a001 : Dc.l blitzScroll

  MOVEM.l D0-D1/A0-A1,-(A7) ;4d8: 48e7c0c0
  EXG D6,A6   ;4dc: cd8e
  JSR -456(A6)  ;4de: 4eaefe38
  EXG D6,A6   ;4e2: cd8e
  MOVEM.l (A7)+,D0-D1/A0-A1 ;4e4: 4cdf0303
  MOVE.l D6,-(A7)  ;4e8: 2f06
  BSR.w blitzScroll  ;4ea: 6100001e
  BTST #6,2(A1)  ;4ee: 082900060002
  LAB_002B:
    BTST #6,2(A1)  ;4f4: 082900060002
  BNE.w LAB_002B  ;4fa: 6600fff8
  MOVE.l (A7)+,D6  ;4fe: 2c1f
  EXG D6,A6   ;500: cd8e
  JSR -462(A6)  ;502: 4eaefe32
  EXG D6,A6   ;506: cd8e
RTS    ;508: 4e75

.blitzScroll:
 CMPI.w #$03c1,-2(A2)  ;50a: 0c6a03c1fffe
 BMI.w LAB_002D  ;510: 6b00002a
 MOVE.w -2(A2),-(A7)  ;514: 3f2afffe
 MOVE.w #$03c0,-2(A2)  ;518: 357c03c0fffe
 MOVEM.l D0-D7/A0-A3,-(A7) ;51e: 48e7fff0
 BSR.w LAB_002D  ;522: 61000018
 MOVEM.l (A7)+,D0-D7/A0-A3 ;526: 4cdf0fff
 MOVE.w (A7)+,-2(A2)  ;52a: 355ffffe
 SUBI.w #$03c0,-2(A2)  ;52e: 046a03c0fffe
 ADDI.w #$03c0,D0  ;534: 064003c0
 ADDI.w #$03c0,D2  ;538: 064203c0
LAB_002D:
 CMP.w D1,D3   ;53c: b641
 BHI.w LAB_0035  ;53e: 6200011c
 BNE.w LAB_002E  ;542: 66000008
 CMP.w D0,D2   ;546: b440
 BHI.w LAB_0035  ;548: 62000112
LAB_002E:
 MOVEM.l A4-A5,-(A7)  ;54c: 48e7000c
 MOVE.w D1,D6   ;550: 3c01
 MULU (A0),D6   ;552: ccd0
 MOVE.w D0,D4   ;554: 3800
 ASR.w #3,D4   ;556: e644
 EXT.l D4   ;558: 48c4
 ADD.l D4,D6   ;55a: dc84
 MOVE.w D3,D7   ;55c: 3e03
 MULU (A3),D7   ;55e: ced3
 MOVE.w D2,D4   ;560: 3802
 ASR.w #3,D4   ;562: e644
 EXT.l D4   ;564: 48c4
 ADD.l D4,D7   ;566: de84
 BSR.w LAB_0038  ;568: 610001ec
 MOVE.w D0,D4   ;56c: 3800
 AND.w #$fff0,D4  ;56e: c87cfff0
 MOVE.w D0,D5   ;572: 3a00
 ADD.w -2(A2),D5  ;574: da6afffe
 AND.w #$fff0,D5  ;578: ca7cfff0
 SUB.w D4,D5   ;57c: 9a44
 LSR.w #4,D5   ;57e: e84d
 ADDQ.w #3,D5   ;580: 5645
 MOVE.w D2,D4   ;582: 3802
 MOVE.w D0,D3   ;584: 3600
 AND.w #$000f,D4  ;586: c87c000f
 AND.w #$000f,D3  ;58a: c67c000f
 SUB.w D3,D4   ;58e: 9843
 BPL.w LAB_002F  ;590: 6a000008
 AND.w #$000f,D4  ;594: c87c000f
 SUBQ.l #2,D7   ;598: 5587
LAB_002F:
 ROR.w #4,D4   ;59a: e85c
 MOVE.w D4,66(A1)  ;59c: 33440042
 OR.w LAB_0004(PC),D4  ;5a0: 887afc96
 MOVE.w D4,64(A1)  ;5a4: 33440040
 MOVE.w D0,D4   ;5a8: 3800
 AND.w #$000f,D4  ;5aa: c87c000f
 ADD.w D4,D4   ;5ae: d844
 LEA LAB_0037(PC),A4  ;5b0: 49fa0182
 MOVE.w 0(A4,D4.w),(A5)  ;5b4: 3ab44000
 MOVE.w D0,D4   ;5b8: 3800
 ADD.w -2(A2),D4  ;5ba: d86afffe
 AND.w #$000f,D4  ;5be: c87c000f
 ADD.w D4,D4   ;5c2: d844
 MOVE.w D5,D3   ;5c4: 3605
 ADD.w D3,D3   ;5c6: d643
 SUBQ.w #6,D3   ;5c8: 5d43
 MOVE.w D3,LAB_0003  ;5ca: 33c300000236
 MOVE.w 0(A4,D4.w),D4  ;5d0: 38344000
 NOT.w D4   ;5d4: 4644
 AND.w D4,0(A5,D3.w)  ;5d6: c9753000
 CLR.l 2(A5,D3.w)  ;5da: 42b53002
 MOVE.l A5,76(A1)  ;5de: 234d004c
LAB_0030:
 MOVE.l #$ffffffff,68(A1) ;5e2: 237cffffffff0044
 MOVE.w 4(A0),D4  ;5ea: 38280004
 CMP.w 4(A3),D4  ;5ee: b86b0004
 BLS.w LAB_0031  ;5f2: 63000006
 MOVE.w 4(A3),D4  ;5f6: 382b0004
LAB_0031:
 SUBQ.w #1,D4   ;5fa: 5344
 MOVE.w D5,D3   ;5fc: 3605
 ADD.w D3,D3   ;5fe: d643
 MOVE.w (A0),D2   ;600: 3410
 SUB.w D3,D2   ;602: 9443
 MOVE.w D2,100(A1)  ;604: 33420064
 MOVE.w (A3),D2   ;608: 3413
 SUB.w D3,D2   ;60a: 9443
 MOVE.w D2,96(A1)  ;60c: 33420060
 MOVE.w D2,102(A1)  ;610: 33420066
 NEG.w D3   ;614: 4443
 MOVE.w D3,98(A1)  ;616: 33430062
 MOVE.w -4(A2),D2  ;61a: 342afffc
 LSL.w #6,D2   ;61e: ed4a
 OR.w D5,D2   ;620: 8445
 ADDQ.w #8,A0   ;622: 5048
 ADDQ.w #8,A3   ;624: 504b
 BRA.w LAB_0034  ;626: 60000012
LAB_0032:
 BTST #6,2(A1)  ;62a: 082900060002
LAB_0033:
 BTST #6,2(A1)  ;630: 082900060002
 BNE.w LAB_0033  ;636: 6600fff8
LAB_0034:
 MOVE.l (A0)+,D0  ;63a: 2018
 ADD.l D6,D0   ;63c: d086
 MOVE.l D0,80(A1)  ;63e: 23400050
 MOVE.l (A3)+,D0  ;642: 201b
 ADD.l D7,D0   ;644: d087
 MOVE.l D0,72(A1)  ;646: 23400048
 MOVE.l D0,84(A1)  ;64a: 23400054
 MOVE.w D2,88(A1)  ;64e: 33420058
 DBF D4,LAB_0032  ;652: 51ccffd6
 MOVEM.l (A7)+,A4-A5  ;656: 4cdf3000
 RTS    ;65a: 4e75
LAB_0035:
 MOVEM.l A4-A5,-(A7)  ;65c: 48e7000c
 MOVE.w D1,D6   ;660: 3c01
 ADD.w -4(A2),D6  ;662: dc6afffc
 SUBQ.w #1,D6   ;666: 5346
 MULU (A0),D6   ;668: ccd0
 MOVE.w D0,D4   ;66a: 3800
 ADD.w -2(A2),D4  ;66c: d86afffe
 SUBQ.w #1,D4   ;670: 5344
 ASR.w #3,D4   ;672: e644
 EXT.l D4   ;674: 48c4
 ADD.l D4,D6   ;676: dc84
 MOVE.w D3,D7   ;678: 3e03
 ADD.w -4(A2),D7  ;67a: de6afffc
 SUBQ.w #1,D7   ;67e: 5347
 MULU (A3),D7   ;680: ced3
 MOVE.w D2,D4   ;682: 3802
 ADD.w -2(A2),D4  ;684: d86afffe
 SUBQ.w #1,D4   ;688: 5344
 ASR.w #3,D4   ;68a: e644
 EXT.l D4   ;68c: 48c4
 ADD.l D4,D7   ;68e: de84
 BSR.w LAB_0038  ;690: 610000c4
 MOVE.w D0,D4   ;694: 3800
 SUBQ.w #1,D4   ;696: 5344
 AND.w #$fff0,D4  ;698: c87cfff0
 MOVE.w D0,D5   ;69c: 3a00
 ADD.w -2(A2),D5  ;69e: da6afffe
 SUBQ.w #1,D5   ;6a2: 5345
 AND.w #$fff0,D5  ;6a4: ca7cfff0
 SUB.w D4,D5   ;6a8: 9a44
 LSR.w #4,D5   ;6aa: e84d
 ADDQ.w #3,D5   ;6ac: 5645
 MOVE.w D2,D3   ;6ae: 3602
 MOVE.w D0,D4   ;6b0: 3800
 ADD.w -2(A2),D3  ;6b2: d66afffe
 SUBQ.w #1,D3   ;6b6: 5343
 ADD.w -2(A2),D4  ;6b8: d86afffe
 SUBQ.w #1,D4   ;6bc: 5344
 AND.w #$000f,D4  ;6be: c87c000f
 AND.w #$000f,D3  ;6c2: c67c000f
 SUB.w D3,D4   ;6c6: 9843
 BPL.w LAB_0036  ;6c8: 6a000008
 AND.w #$000f,D4  ;6cc: c87c000f
 ADDQ.l #2,D7   ;6d0: 5487
LAB_0036:
 ROR.w #4,D4   ;6d2: e85c
 MOVE.w D4,D3   ;6d4: 3604
 ORI.w #$0002,D3  ;6d6: 00430002
 MOVE.w D3,66(A1)  ;6da: 33430042
 OR.w LAB_0004(PC),D4  ;6de: 887afb58
 MOVE.w D4,64(A1)  ;6e2: 33440040
 LEA LAB_0037(PC),A4  ;6e6: 49fa004c
 MOVE.w D0,D4   ;6ea: 3800
 ADD.w -2(A2),D4  ;6ec: d86afffe
 SUBQ.w #1,D4   ;6f0: 5344
 AND.w #$000f,D4  ;6f2: c87c000f
 ADD.w D4,D4   ;6f6: d844
 MOVE.w 2(A4,D4.w),D4  ;6f8: 38344002
 NOT.w D4   ;6fc: 4644
 MOVE.w D4,142(A5)  ;6fe: 3b44008e
 MOVE.w D5,D4   ;702: 3805
 ADD.w D4,D4   ;704: d844
 MOVE.w #$0090,D3  ;706: 363c0090
 SUB.w D4,D3   ;70a: 9644
 MOVE.w D3,LAB_0003  ;70c: 33c300000236
 MOVE.w D0,D4   ;712: 3800
 SUBQ.w #1,D4   ;714: 5344
 AND.w #$000f,D4  ;716: c87c000f
 ADD.w D4,D4   ;71a: d844
 MOVE.w 2(A4,D4.w),D4  ;71c: 38344002
 CLR.l 0(A5,D3.w)  ;720: 42b53000
 AND.w D4,4(A5,D3.w)  ;724: c9753004
 LEA 142(A5),A5  ;728: 4bed008e
 MOVE.l A5,76(A1)  ;72c: 234d004c
 BRA.w LAB_0030  ;730: 6000feb0

LAB_0037: Dc.w $ffff   ;734
          Dc.w $7fff   ;736
          Dc.w $3fff   ;738
          Dc.w $1fff   ;73a
          Dc.w $0fff   ;73c
          Dc.w $07ff   ;73e
          Dc.w $03ff   ;740
          Dc.w $01ff   ;742
          Dc.w $00ff   ;744
          Dc.w $007f   ;746
          Dc.w $003f   ;748
          ORI.b #$0f,(A7)+  ;74a: 001f000f
          ORI.b #$03,D7   ;74e: 00070003
          ORI.b #$00,D1   ;752: 00010000

LAB_0038:
  BTST #6,2(A1)  ;756: 082900060002
  LAB_0039:
    BTST #6,2(A1)  ;75c: 082900060002
  BNE.w LAB_0039  ;762: 6600fff8
  MOVEA.l LAB_0002(PC),A5  ;766: 2a7afaca
  MOVEQ #-1,D5   ;76a: 7aff
  MOVE.w D5,(A5)   ;76c: 3a85
  MOVE.w D5,142(A5)  ;76e: 3b45008e
  MOVE.w LAB_0003(PC),D4  ;772: 383afac2
  MOVE.l D5,0(A5,D4.w)  ;776: 2b854000
  MOVE.w D5,4(A5,D4.w)  ;77a: 3b854004
RTS

.do_BlockScroll:
  Dc.w $a001 : Dc.l blitzBlockScroll

  MOVEM.l D0-D1/A0-A1,-(A7)
  EXG D6,A6
  JSR _OwnBlitter(A6)
  EXG D6,A6
  MOVEM.l (A7)+,D0-D1/A0-A1

  MOVE.l D6,-(A7)
  BSR.w blitzBlockScroll

  BTST #6,2(A1)
  LAB_003B:
    BTST #6,2(A1)
  BNE.w LAB_003B
  MOVE.l (A7)+,D6

  EXG D6,A6
  JSR _DisownBlit(A6)
  EXG D6,A6
RTS

blitzBlockScroll:
 MOVE.w (A0),D4   ;7b8: 3810
 MOVE.w (A3),D5   ;7ba: 3a13
 MULU D4,D1   ;7bc: c2c4
 ASR.w #3,D0   ;7be: e640
 EXT.l D0   ;7c0: 48c0
 ADD.l D0,D1   ;7c2: d280
 MULU D5,D3   ;7c4: c6c5
 ASR.w #3,D2   ;7c6: e642
 EXT.l D2   ;7c8: 48c2
 ADD.l D2,D3   ;7ca: d682
 MOVEM.w -4(A2),D0/D2  ;7cc: 4caa0005fffc
 LSR.w #3,D2   ;7d2: e64a
 SUB.w D2,D4   ;7d4: 9842
 SUB.w D2,D5   ;7d6: 9a42
 ASR.w #1,D2   ;7d8: e242
 ASL.w #6,D0   ;7da: ed40
 OR.w D0,D2   ;7dc: 8440
 BTST #6,2(A1)  ;7de: 082900060002
LAB_003D:
 BTST #6,2(A1)  ;7e4: 082900060002
 BNE.w LAB_003D  ;7ea: 6600fff8
 MOVE.l #$09f00000,64(A1) ;7ee: 237c09f000000040
 MOVEQ #-1,D0   ;7f6: 70ff
 MOVE.l D0,68(A1)  ;7f8: 23400044
 MOVEM.w D4-D5,100(A1)  ;7fc: 48a900300064
 MOVE.w 4(A0),D4  ;802: 38280004
 CMP.w 4(A3),D4  ;806: b86b0004
 BLS.w LAB_003E  ;80a: 63000006
 MOVE.w 4(A3),D4  ;80e: 382b0004
LAB_003E:
 SUBQ.w #1,D4   ;812: 5344
 ADDQ.w #8,A0   ;814: 5048
 ADDQ.w #8,A3   ;816: 504b
 BRA.w LAB_0041  ;818: 60000012
LAB_003F:
 BTST #6,2(A1)  ;81c: 082900060002
LAB_0040:
 BTST #6,2(A1)  ;822: 082900060002
 BNE.w LAB_0040  ;828: 6600fff8
LAB_0041:
 MOVE.l (A0)+,D0  ;82c: 2018
 ADD.l D1,D0   ;82e: d081
 MOVE.l D0,80(A1)  ;830: 23400050
 MOVE.l (A3)+,D0  ;834: 201b
 ADD.l D3,D0   ;836: d083
 MOVE.l D0,84(A1)  ;838: 23400054
 MOVE.w D2,88(A1)  ;83c: 33420058
 DBF D4,LAB_003F  ;840: 51ccffda
RTS    ;844: 4e75

; ========================================================================
errors:
errIllegalArea: MOVE.l #message1,D0 : TRAP #0
errBitmap:   MOVE.l #message2,D0 : TRAP #0
errAreaLarge:   MOVE.l #message3,D0 : TRAP #0

message1: Dc.b "Illegal Scroll Area",0
message2: Dc.b "Uninitialized BitMap",0
message3: Dc.b "Scroll area to large",0

chkXYBitmap:
  MOVE.w D0,D4
  MOVE.w D1,D5
  BSR.w LAB_004B
  EXG A0,A3
  BSR.w LAB_004A
  EXG A0,A3
RTS

chkXY:
  MOVE.w D0,D4
  MOVE.w D1,D5
  BSR.w LAB_004B

LAB_004A:
  MOVE.w D2,D4
  MOVE.w D3,D5

LAB_004B:
  CMPI.w #1024,-4(A2) : BHI.w errAreaLarge
  TST.w 62(A0) : BEQ.w errBitmap

  CMP.w 58(A0),D5 : BCC.w errIllegalArea

  ADD.w -4(A2),D5
  CMP.w 58(A0),D5 : BHI.w errIllegalArea

  MOVE.w 56(A0),D5
  CMP.w D5,D4 : BCC.w errIllegalArea

  ADD.w -2(A2),D4
  CMP.w D5,D4 : BHI.w errIllegalArea
RTS

.chkBitMap:
  TST.w 62(A2) : BEQ.w errBitmap
RTS
