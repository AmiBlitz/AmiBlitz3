; XTRA
; Embedded .xtra Header
; 
; General Info
; -------------------------------------------------------
; ExePath         = "blitz3:blitzlibs/decompiled/baselibs"
; ExeFile         = "cliargslib_new.obj"
; CreateIcon      = 0
; Residents       = "libmacs.res,blitzoffs.res"
; 
; Compiler
; -------------------------------------------------------
; StringBuffer    = 10240
; MakeSmallest    = 1
; FuncOptimize    = 1
; Version         = 0.0.0
; NumberOfBuilds  = 3
; 
; Debugger
; -------------------------------------------------------
; CliArgs         = ""
; StackSize       = 8191
; RuntimeDebug    = 0
; DebugInfo       = 0
; CreateDbgFile   = 0
; OverflowCheck   = 0
; AssemblerCheck  = 0
; InterruptCheck  = 1
; AutoRun         = 1
; 
; Editor
; -------------------------------------------------------
; CursorLine      = 86
; CursorColumn    = 20
; LabelSearch     = ""
; LabelRemark     = 0
; LabelAll        = 0
; LabelCase       = 0
; LabelPosition   = 0
; 
; Blitz Objects
; -------------------------------------------------------
; Max File        = 5
; Max GadgetList  = 5
; Max Shape       = 100
; Max Bank        = 5
; Max MenuList    = 5
; Max GTList      = 5
; Max BitMap      = 10
; Max Screen      = 5
; Max IntuiFont   = 5
; Max Window      = 5
; Max Palette     = 4
; Max BlitzFont   = 4
; Max IconInfo    = 1
; Max MUIObject   = 50
; Max AsyncReq    = 4
; Max Req-Lib     = 5
; Max GTMenuList  = 5
; Max Console     = 5
; Max TCPSock     = 16
; Max Tape        = 5
; Max TagList     = 5
; Max Database    = 16
; Max Sound       = 10
; Max MedModule   = 8
; Max Buffer      = 10
; Max Queue       = 10
; Max Sprite      = 20
; Max Module      = 5
; Max Slice       = 10
; Max Page        = 4
; Max CopList     = 10
; Max PTModule    = 5
; Max Anim        = 100
; Max NChunky     = 50
; Max Chunky      = 20
; Max Stencil     = 5
; Max XBSound     = 10
; /XTRA
!libheader{#cliargslib,0,0,0,errorhandlers}

!afunction{#word}
!args
!libs{#wbstartuplib,#la0}
!subs{do_numpars,0,0}
!name{"NumPars","  pars.w=NumPars  Number of paramters passed to program."}

!afunction{#string}
!args{#long}
!libs{#wbstartuplib,#la0}
!subs{do_par,errchk,0}
!name{"Par$","  parameter$=Par$(Paramter#)   Returns the string value of a parameter."}

!afunction{#word}
!args
!libs{#wbstartuplib,#la0}
!subs{do_fromcli,0,0}
!name{"FromCLI","  result=FromCLI   0=Run from WorkBench, -1=Run from CLI"}


!afunction{#string}
!args{#long,#word}
!libs{#wbstartuplib,#la0,#doslib,#la6}
!subs{do_parpath,errchkwb,0}
!name{"ParPath$","  path$=ParPath$(Par#,#type)  Full/Dir path of WB arg. (v36+ only!)"}

!libfin
 
; =============================================== code
.do_parpath:
  MOVE.w D1,D4
  BSR.w LAB_0008
  MOVEA.l A1,A2
  MOVE.l 10(A1),D1			; lock
  MOVE.l #stringVar,D2		; buffer
  MOVE.l #$000000ff,D3      ; length
  JSR _NameFromLock(A6) : BEQ.w LAB_0002
    LEA stringVar,A0
    BSR.w copyA0toA3
    TST.w D4 : BEQ.w LAB_0002
    CMPI.b #$3a,-1(A3) : BEQ.w LAB_0001
    MOVE.b #$2f,(A3)+
    ADDQ.l #1,D0
   LAB_0001:
    MOVE.l D0,D1
    MOVEA.l 4(A2),A0
    BSR.w copyA0toA3
    ADD.l D1,D0
  LAB_0002:
RTS

copyA0toA3:
  MOVEQ #0,D0
  LAB_0004:
    ADDQ.l #1,D0
    MOVE.b (A0)+,(A3)+
  BNE.w LAB_0004
  SUBQ.w #1,A3  
  SUBQ.l #1,D0  
RTS

.do_fromcli:
  MOVE.w (A0),D0
RTS

.do_numpars:
  MOVE.l 2(A0),D0
RTS

.do_par:
  BSR.w LAB_0008
  MOVEA.l 4(A1),A0
  BSR.w copyA0toA3
RTS

LAB_0008:
  MOVEA.l 6(A0),A1
LAB_0009:
  SUBQ.l #1,D0 : BEQ.w LAB_000A
  MOVEA.l 0(A1),A1
  BRA.w LAB_0009
  LAB_000A:
RTS

stringVar: Ds.l 64
 
; ======================== error checking
errorhandlers:
errchkwb
 TST.w (A0) : BNE.w LAB_000E

errchk:
 TST.l 2(A0) : BEQ.w LAB_0010
 CMP.l 2(A0),D0 : BGT.w LAB_000F
 TST.l D0 : BLE.w LAB_000F
RTS

LAB_000E: MOVE.l #LAB_0013,D0 : TRAP #0
LAB_000F: MOVE.l #LAB_0011,D0 : TRAP #0
LAB_0010: MOVE.l #LAB_0012,D0 : TRAP #0

LAB_0011: Dc.b "Non-Existent Parameter.",0
LAB_0012: Dc.b "No parameters passed.",0
LAB_0013: Dc.b "Can only call ParPath$() when run from WB.",0,0
