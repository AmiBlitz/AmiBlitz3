; XTRA
; Embedded .xtra Header
; 
; General Info
; -------------------------------------------------------
; ExePath         = "Blitz3:BlitzLibs/Decompiled/baselibs"
; ExeFile         = "sortlib_new.obj"
; CreateIcon      = 0
; Residents       = "libmacs.res,blitzoffs.res,all.res"
; 
; Compiler
; -------------------------------------------------------
; StringBuffer    = 10240
; MakeSmallest    = 1
; FuncOptimize    = 1
; Version         = 0.0.0
; NumberOfBuilds  = 6
; 
; Debugger
; -------------------------------------------------------
; CliArgs         = ""
; StackSize       = 8191
; RuntimeDebug    = 0
; DebugInfo       = 0
; CreateDbgFile   = 0
; OverflowCheck   = 1
; AssemblerCheck  = 0
; InterruptCheck  = 1
; AutoRun         = 1
; 
; Editor
; -------------------------------------------------------
; CursorLine      = 29
; CursorColumn    = 12
; LabelSearch     = "init"
; LabelRemark     = 0
; LabelAll        = 373
; LabelCase       = 0
; LabelPosition   = 0
; 
; Blitz Objects
; -------------------------------------------------------
; Max File        = 5
; Max GadgetList  = 5
; Max Shape       = 100
; Max Bank        = 5
; Max MenuList    = 5
; Max GTList      = 5
; Max Palette     = 4
; Max BitMap      = 10
; Max Screen      = 5
; Max IntuiFont   = 5
; Max BlitzFont   = 4
; Max Window      = 5
; Max IconInfo    = 1
; Max MUIObject   = 5
; Max AsyncReq    = 4
; Max Req-Lib     = 5
; Max GTMenuList  = 5
; Max Console     = 5
; Max TCPSock     = 5
; Max Tape        = 5
; Max TagList     = 5
; Max Database    = 16
; Max Sound       = 10
; Max MedModule   = 8
; Max Buffer      = 10
; Max Queue       = 10
; Max Sprite      = 20
; Max Module      = 5
; Max Slice       = 10
; Max Page        = 4
; Max CopList     = 10
; Max PTModule    = 5
; Max Anim        = 100
; Max NChunky     = 50
; Max Chunky      = 20
; Max Stencil     = 5
; Max XBSound     = 10
; /XTRA
#_LVOSPCmp = -42

!libheader {#sortlib,init,0,0,0}

!astatement
!args{#array|#arrayend|#unknown}
!libs{#ffplib,#la6}
!subs{do_sort,0,0}
!name{"Sort","Arrayname()"}

!astatement                               ; just a copy for a new token with different name
!args{#array|#arrayend|#unknown}
!libs{#ffplib,#la6}
!subs{do_sort,0,0}
!name{"ArraySort","Arrayname()"}

!astatement
!args
!libs
!subs{do_sortUp,0,0}
!name{"SortUp",""}

!astatement
!args
!libs
!subs{do_sortDown,0,0}
!name{"SortDown",""}

!astatement
!args{$38,#unknown}
!libs
!subs{do_FillArray2,0,0}
!args{$38}
!libs
!subs{do_FillArray1,0,0}
!name{"ArrayFill","Arrayname()[,value] - only builtin datatypes are supported"}

!afunction{#long}
!args{$38}
!libs
!subs{do_ArraySize,0,0}
!name{"ArraySize","(Arrayname()) - get the amount of memory the array consumes"}

!afunction{#long}
!args{#array|#arrayend|#unknown}
!libs
!subs{do_ArrayElements,0,0}
!name{"ArrayElements","(Arrayname()) - get the number of elements the array consists of"}

!afunction{#word}
!args{$38}
!libs
!subs{do_ArrayDataType,0,0}
!name{"ArrayDataType","(Arrayname()) - get the datatype of the arrays elements"}


; ***************************************************************************
init: !nullsub{do_sortUp,0,0}
!libfin
; ***************************************************************************

sortMode: Ds.w 1

.do_sortUp:
  CLR.w sortMode
RTS

.do_sortDown:
  MOVE.w #$ffff,sortMode
RTS
 
.do_sort:
 MOVEA.l D0,A0  
 MOVEA.l -(A2),A1
 MOVE.w -(A2),D1 
 CMPI.w #$0004,D1 : BEQ.w LAB_0006  
 CMPI.w #$0002,D1 : BEQ.w LAB_001C
 CMPI.w #$0001,D1 : BEQ.w LAB_0011
 CMPI.w #$0005,D1 : BEQ.w LAB_0032
 CMPI.w #$0007,D1 : BEQ.w LAB_0027 ; string

LAB_0006:
 SUBQ.w #4,A1   ;110: 5949
LAB_0007:
 MOVE.l A0,D6   ;112: 2c08
 MOVE.l A1,D7   ;114: 2e09
 MOVE.l A1,D0   ;116: 2009
 SUB.l A0,D0   ;118: 9088
 LSR.l #1,D0   ;11a: e288
 AND.l #$fffffffc,D0  ;11c: c0bcfffffffc
 MOVE.l 0(A0,D0.l),D0  ;122: 20300800
LAB_0008:
 MOVE.w sortMode(PC),D1  ;126: 323affa6
 BEQ.w LAB_000B  ;12a: 67000018
LAB_0009:
 CMP.l (A0)+,D0  ;12e: b098
 BLT.w LAB_0009  ;130: 6d00fffc
 SUBQ.w #4,A0   ;134: 5948
 ADDQ.w #4,A1   ;136: 5849
LAB_000A:
 SUBQ.w #4,A1   ;138: 5949
 CMP.l (A1),D0   ;13a: b091
 BGT.w LAB_000A  ;13c: 6e00fffa
 BRA.w LAB_000D  ;140: 60000014
LAB_000B:
 CMP.l (A0)+,D0  ;144: b098
 BGT.w LAB_000B  ;146: 6e00fffc
 SUBQ.w #4,A0   ;14a: 5948
 ADDQ.w #4,A1   ;14c: 5849
LAB_000C:
 SUBQ.w #4,A1   ;14e: 5949
 CMP.l (A1),D0   ;150: b091
 BLT.w LAB_000C  ;152: 6d00fffa
LAB_000D:
 CMPA.l A1,A0   ;156: b1c9
 BHI.w LAB_000E  ;158: 62000010
 MOVE.l (A0),D1   ;15c: 2210
 MOVE.l (A1),(A0)+  ;15e: 20d1
 MOVE.l D1,(A1)   ;160: 2281
 SUBQ.w #4,A1   ;162: 5949
 CMPA.l A1,A0   ;164: b1c9
 BLS.w LAB_0008  ;166: 6300ffbe
LAB_000E:
 CMP.l A1,D6   ;16a: bc89
 BCC.w LAB_000F  ;16c: 64000010
 MOVE.l A0,-(A7)  ;170: 2f08
 MOVE.l D7,-(A7)  ;172: 2f07
 MOVEA.l D6,A0   ;174: 2046
 BSR.w LAB_0007  ;176: 6100ff9a
 MOVE.l (A7)+,D7  ;17a: 2e1f
 MOVEA.l (A7)+,A0  ;17c: 205f
LAB_000F:
 CMPA.l D7,A0   ;17e: b1c7
 BCC.w LAB_0010  ;180: 64000008
 MOVEA.l D7,A1   ;184: 2247
 BRA.w LAB_0007  ;186: 6000ff8a
LAB_0010:
 RTS    ;18a: 4e75
LAB_0011:
 SUBQ.w #1,A1   ;18c: 5349
LAB_0012:
 MOVE.l A0,D6   ;18e: 2c08
 MOVE.l A1,D7   ;190: 2e09
 MOVE.l A1,D0   ;192: 2009
 SUB.l A0,D0   ;194: 9088
 LSR.l #1,D0   ;196: e288
 MOVE.b 0(A0,D0.l),D0  ;198: 10300800
LAB_0013:
 MOVE.w sortMode(PC),D1  ;19c: 323aff30
 BEQ.w LAB_0016  ;1a0: 67000018
LAB_0014:
 CMP.b (A0)+,D0  ;1a4: b018
 BLT.w LAB_0014  ;1a6: 6d00fffc
 SUBQ.w #1,A0   ;1aa: 5348
 ADDQ.w #1,A1   ;1ac: 5249
LAB_0015:
 SUBQ.w #1,A1   ;1ae: 5349
 CMP.b (A1),D0   ;1b0: b011
 BGT.w LAB_0015  ;1b2: 6e00fffa
 BRA.w LAB_0018  ;1b6: 60000014
LAB_0016:
 CMP.b (A0)+,D0  ;1ba: b018
 BGT.w LAB_0016  ;1bc: 6e00fffc
 SUBQ.w #1,A0   ;1c0: 5348
 ADDQ.w #1,A1   ;1c2: 5249
LAB_0017:
 SUBQ.w #1,A1   ;1c4: 5349
 CMP.b (A1),D0   ;1c6: b011
 BLT.w LAB_0017  ;1c8: 6d00fffa
LAB_0018:
 CMPA.l A1,A0   ;1cc: b1c9
 BHI.w LAB_0019  ;1ce: 62000010
 MOVE.b (A0),D1   ;1d2: 1210
 MOVE.b (A1),(A0)+  ;1d4: 10d1
 MOVE.b D1,(A1)   ;1d6: 1281
 SUBQ.w #1,A1   ;1d8: 5349
 CMPA.l A1,A0   ;1da: b1c9
 BLS.w LAB_0013  ;1dc: 6300ffbe
LAB_0019:
 CMP.l A1,D6   ;1e0: bc89
 BCC.w LAB_001A  ;1e2: 64000010
 MOVE.l A0,-(A7)  ;1e6: 2f08
 MOVE.l D7,-(A7)  ;1e8: 2f07
 MOVEA.l D6,A0   ;1ea: 2046
 BSR.w LAB_0012  ;1ec: 6100ffa0
 MOVE.l (A7)+,D7  ;1f0: 2e1f
 MOVEA.l (A7)+,A0  ;1f2: 205f
LAB_001A:
 CMPA.l D7,A0   ;1f4: b1c7
 BCC.w LAB_001B  ;1f6: 64000008
 MOVEA.l D7,A1   ;1fa: 2247
 BRA.w LAB_0012  ;1fc: 6000ff90
LAB_001B:
 RTS    ;200: 4e75
LAB_001C:
 SUBQ.w #2,A1   ;202: 5549
LAB_001D:
 MOVE.l A0,D6   ;204: 2c08
 MOVE.l A1,D7   ;206: 2e09
 MOVE.l A1,D0   ;208: 2009
 SUB.l A0,D0   ;20a: 9088
 LSR.l #1,D0   ;20c: e288
 AND.l #$fffffffe,D0  ;20e: c0bcfffffffe
 MOVE.l 0(A0,D0.l),D0  ;214: 20300800
LAB_001E:
 MOVE.w sortMode(PC),D1  ;218: 323afeb4
 BEQ.w LAB_0021  ;21c: 67000018
LAB_001F:
 CMP.w (A0)+,D0  ;220: b058
 BLT.w LAB_001F  ;222: 6d00fffc
 SUBQ.w #2,A0   ;226: 5548
 ADDQ.w #2,A1   ;228: 5449
LAB_0020:
 SUBQ.w #2,A1   ;22a: 5549
 CMP.w (A1),D0   ;22c: b051
 BGT.w LAB_0020  ;22e: 6e00fffa
 BRA.w LAB_0023  ;232: 60000014
LAB_0021:
 CMP.w (A0)+,D0  ;236: b058
 BGT.w LAB_0021  ;238: 6e00fffc
 SUBQ.w #2,A0   ;23c: 5548
 ADDQ.w #2,A1   ;23e: 5449
LAB_0022:
 SUBQ.w #2,A1   ;240: 5549
 CMP.w (A1),D0   ;242: b051
 BLT.w LAB_0022  ;244: 6d00fffa
LAB_0023:
 CMPA.l A1,A0   ;248: b1c9
 BHI.w LAB_0024  ;24a: 62000010
 MOVE.w (A0),D1   ;24e: 3210
 MOVE.w (A1),(A0)+  ;250: 30d1
 MOVE.w D1,(A1)   ;252: 3281
 SUBQ.w #2,A1   ;254: 5549
 CMPA.l A1,A0   ;256: b1c9
 BLS.w LAB_001E  ;258: 6300ffbe
LAB_0024:
 CMP.l A1,D6   ;25c: bc89
 BCC.w LAB_0025  ;25e: 64000010
 MOVE.l A0,-(A7)  ;262: 2f08
 MOVE.l D7,-(A7)  ;264: 2f07
 MOVEA.l D6,A0   ;266: 2046
 BSR.w LAB_001D  ;268: 6100ff9a
 MOVE.l (A7)+,D7  ;26c: 2e1f
 MOVEA.l (A7)+,A0  ;26e: 205f
LAB_0025:
 CMPA.l D7,A0   ;270: b1c7
 BCC.w LAB_0026  ;272: 64000008
 MOVEA.l D7,A1   ;276: 2247
 BRA.w LAB_001D  ;278: 6000ff8a
LAB_0026:
 RTS    ;27c: 4e75

LAB_0027:
 SUBQ.w #4,A1   ;27e: 5949
LAB_0028:
 MOVE.l A0,D6   ;280: 2c08
 MOVE.l A1,D7   ;282: 2e09
 MOVE.l A1,D0   ;284: 2009
 SUB.l A0,D0   ;286: 9088
 LSR.l #1,D0   ;288: e288
 AND.l #$fffffffc,D0  ;28a: c0bcfffffffc
 MOVE.l 0(A0,D0.l),D0  ;290: 20300800
LAB_0029:
 MOVE.w sortMode(PC),D1  ;294: 323afe38
 BEQ.w LAB_002C  ;298: 67000020
LAB_002A:
 MOVE.l (A0)+,D1  ;29c: 2218
 BSR.w LAB_003D  ;29e: 610000f8
 BLT.w LAB_002A  ;2a2: 6d00fff8
 SUBQ.w #4,A0   ;2a6: 5948
 ADDQ.w #4,A1   ;2a8: 5849
LAB_002B:
 SUBQ.w #4,A1   ;2aa: 5949
 MOVE.l (A1),D1   ;2ac: 2211
 BSR.w LAB_003D  ;2ae: 610000e8
 BGT.w LAB_002B  ;2b2: 6e00fff6
 BRA.w LAB_002E  ;2b6: 6000001c
LAB_002C:
 MOVE.l (A0)+,D1  ;2ba: 2218
 BSR.w LAB_003D  ;2bc: 610000da
 BGT.w LAB_002C  ;2c0: 6e00fff8
 SUBQ.w #4,A0   ;2c4: 5948
 ADDQ.w #4,A1   ;2c6: 5849
LAB_002D:
 SUBQ.w #4,A1   ;2c8: 5949
 MOVE.l (A1),D1   ;2ca: 2211
 BSR.w LAB_003D  ;2cc: 610000ca
 BLT.w LAB_002D  ;2d0: 6d00fff6
LAB_002E:
 CMPA.l A1,A0   ;2d4: b1c9
 BHI.w LAB_002F  ;2d6: 62000010
 MOVE.l (A0),D1   ;2da: 2210
 MOVE.l (A1),(A0)+  ;2dc: 20d1
 MOVE.l D1,(A1)   ;2de: 2281
 SUBQ.w #4,A1   ;2e0: 5949
 CMPA.l A1,A0   ;2e2: b1c9
 BLS.w LAB_0029  ;2e4: 6300ffae
LAB_002F:
 CMP.l A1,D6   ;2e8: bc89
 BCC.w LAB_0030  ;2ea: 64000010
 MOVE.l A0,-(A7)  ;2ee: 2f08
 MOVE.l D7,-(A7)  ;2f0: 2f07
 MOVEA.l D6,A0   ;2f2: 2046
 BSR.w LAB_0028  ;2f4: 6100ff8a
 MOVE.l (A7)+,D7  ;2f8: 2e1f
 MOVEA.l (A7)+,A0  ;2fa: 205f
LAB_0030:
 CMPA.l D7,A0   ;2fc: b1c7
 BCC.w LAB_0031  ;2fe: 64000008
 MOVEA.l D7,A1   ;302: 2247
 BRA.w LAB_0028  ;304: 6000ff7a
LAB_0031:
 RTS    ;308: 4e75
LAB_0032:
 SUBQ.w #4,A1   ;30a: 5949
LAB_0033:
 MOVE.l A0,D6   ;30c: 2c08
 MOVE.l A1,D7   ;30e: 2e09
 MOVE.l A1,D0   ;310: 2009
 SUB.l A0,D0   ;312: 9088
 LSR.l #1,D0   ;314: e288
 AND.l #$fffffffc,D0  ;316: c0bcfffffffc
 MOVE.l 0(A0,D0.l),D0  ;31c: 20300800
LAB_0034:
 MOVE.w sortMode(PC),D1  ;320: 323afdac
 BEQ.w LAB_0037  ;324: 67000020
LAB_0035:
 MOVE.l (A0)+,D1  ;328: 2218
 BSR.w ffpcompare  ;32a: 61000088
 BLT.w LAB_0035  ;32e: 6d00fff8
 SUBQ.w #4,A0   ;332: 5948
 ADDQ.w #4,A1   ;334: 5849
LAB_0036:
 SUBQ.w #4,A1   ;336: 5949
 MOVE.l (A1),D1   ;338: 2211
 BSR.w ffpcompare  ;33a: 61000078
 BGT.w LAB_0036  ;33e: 6e00fff6
 BRA.w LAB_0039  ;342: 6000001c
LAB_0037:
 MOVE.l (A0)+,D1  ;346: 2218
 BSR.w ffpcompare  ;348: 6100006a
 BGT.w LAB_0037  ;34c: 6e00fff8
 SUBQ.w #4,A0   ;350: 5948
 ADDQ.w #4,A1   ;352: 5849
LAB_0038:
 SUBQ.w #4,A1   ;354: 5949
 MOVE.l (A1),D1   ;356: 2211
 BSR.w ffpcompare  ;358: 6100005a
 BLT.w LAB_0038  ;35c: 6d00fff6
LAB_0039:
 CMPA.l A1,A0   ;360: b1c9
 BHI.w LAB_003A  ;362: 62000010
 MOVE.l (A0),D1   ;366: 2210
 MOVE.l (A1),(A0)+  ;368: 20d1
 MOVE.l D1,(A1)   ;36a: 2281
 SUBQ.w #4,A1   ;36c: 5949
 CMPA.l A1,A0   ;36e: b1c9
 BLS.w LAB_0034  ;370: 6300ffae
LAB_003A:
 CMP.l A1,D6   ;374: bc89
 BCC.w LAB_003B  ;376: 64000010
 MOVE.l A0,-(A7)  ;37a: 2f08
 MOVE.l D7,-(A7)  ;37c: 2f07
 MOVEA.l D6,A0   ;37e: 2046
 BSR.w LAB_0033  ;380: 6100ff8a
 MOVE.l (A7)+,D7  ;384: 2e1f
 MOVEA.l (A7)+,A0  ;386: 205f
LAB_003B:
 CMPA.l D7,A0   ;388: b1c7
 BCC.w LAB_003C  ;38a: 64000008
 MOVEA.l D7,A1   ;38e: 2247
 BRA.w LAB_0033  ;390: 6000ff7a
LAB_003C:
RTS
RTS

.LAB_003D:
  MOVEM.l D0/A0-A1,-(A7)
  MOVEA.l D0,A0  
  MOVE.l -4(A0),D0
  MOVEA.l D1,A1  
  MOVE.l -4(A1),D1
  ALibJsr $ce02
  MOVEM.l (A7)+,D0/A0-A1
RTS

.ffpcompare:
  MOVEM.l D0/A0-A1,-(A7)
  JSR _LVOSPCmp(A6)
  MOVEM.l (A7)+,D0/A0-A1
RTS


 

.do_FillArray1:
  Dc.b $A0,$00 ;..
  Dc.w JL_0_106-JL_0_D0
  JL_0_D0:

  MOVEA.l D0,A0       ; begin of array
  MOVEA.l -(A2),A1    ; end of array
  MOVE.w -(A2),D2     ; datatype of array

  CMPI.b #$1,D2 : BEQ.b JL_0_FE
  CMPI.b #$2,D2 : BEQ.b JL_0_F4
  CMPI.b #$3,D2 : BNE.b JL_0_106

  JL_0_E8:
    MOVE.l #$00000000,(A0)+
  CMPA.l A0,A1 : BNE.b JL_0_E8
  BRA.b JL_0_106

  JL_0_F4:
    MOVE.w #$0000,(A0)+
  CMPA.l A0,A1 : BNE.b JL_0_F4
  BRA.b JL_0_106

  JL_0_FE:
    MOVE.b #$0,(A0)+
  CMPA.l A0,A1 : BNE.b JL_0_FE

  JL_0_106:
RTS

.do_FillArray2:
  Dc.b $A0,$00 ;..
  Dc.w JL_0_13A-JL_0_10C
  JL_0_10C:

  MOVEA.l D0,A0     ; begin of array
  MOVEA.l -(A2),A1  ; end of array
  MOVE.w -(A2),D2   ; datatype of array

  CMPI.b #$1,D2 : BEQ.b JL_0_134
  CMPI.b #$2,D2 : BEQ.b JL_0_12C
  CMPI.b #$3,D2 : BNE.b JL_0_13A

  JL_0_124:
    MOVE.l D1,(A0)+
  CMPA.l A0,A1 : BNE.b JL_0_124
  BRA.b JL_0_13A

  JL_0_12C:
    MOVE.w D1,(A0)+
  CMPA.l A0,A1 : BNE.b JL_0_12C
  BRA.b JL_0_13A

  JL_0_134:
    MOVE.b D1,(A0)+
  CMPA.l A0,A1 : BNE.b JL_0_134
  
  JL_0_13A:
RTS

.do_ArraySize:
  MOVE.l -(A2),D1   ; end of array
  SUB.l D0,D1       ; d0: begin of array
  MOVE.l D1,D0
RTS




.do_ArrayElements:

  MOVE.l -(A2),D1   ; end of array
  MOVE.w -(A2),D2   ; datatype of array

  ;-- check the datatype
  ;datatypes...
  ;#byte=1
  ;#word=2
  ;#long=3
  ;#quick=4
  ;#float=5
  ;#string=7
  ;#double=8  

  CMPI.w #$0009,D2 : BCC.w 'unsupported

  MOVEQ #0,D3
  CMPI.w #$0004,D2 : BEQ.w 'long
    CMPI.w #$0002,D2 : BNE.w 'noword
      MOVE.w #2,D3  
      BRA.w 'calc
   'noword  
    CMPI.w #$0001,D2 : BNE.w 'nobyte
      MOVE.w #1,D3  
      BRA.w 'calc
   'nobyte
    CMPI.w #$0005,D2 : BNE.w 'nofloat
      MOVE.w #4,D3
      BRA.w 'calc
   'nofloat
    CMPI.w #$0008,D2 : BNE.w 'nodouble
      MOVE.w #8,D3
      BRA.w 'calc
   'nodouble
    CMPI.w #$0007,D2 : BNE.w 'long
      MOVE.w #4,D3
      BRA.w 'calc
 'long:
   MOVE.w #4,D3

 'calc:
  SUB.l D0,D1
  DIVU.w D3,D1

 'exit:
  MOVE.l D1,D0
  RTS

 'unsupported:
  MOVEQ #0,D0 
RTS


.do_ArrayDataType:
  MOVEQ #0,D0
  MOVE.w -6(A2),D0
RTS

