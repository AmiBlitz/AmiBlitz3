; XTRA
; Embedded .xtra Header
; 
; General Info
; -------------------------------------------------------
; ExePath         = "Development:AmiBlitz3/BlitzLibs/Decompiled/baselibs"
; ExeFile         = "gameio_new.obj"
; CreateIcon      = 0
; Residents       = "libmacs.res,libjsrs.res,blitzoffs.res"
; 
; Compiler
; -------------------------------------------------------
; StringBuffer    = 10240
; MakeSmallest    = 1
; FuncOptimize    = 1
; Version         = 0.0.0
; NumberOfBuilds  = 0
; 
; Debugger
; -------------------------------------------------------
; CliArgs         = ""
; StackSize       = 8191
; RuntimeDebug    = 0
; DebugInfo       = 0
; CreateDbgFile   = 0
; OverflowCheck   = 1
; AssemblerCheck  = 0
; InterruptCheck  = 1
; AutoRun         = 1
; 
; Editor
; -------------------------------------------------------
; CursorLine      = 3
; CursorColumn    = 10
; LabelSearch     = ""
; LabelRemark     = 0
; LabelAll        = 1
; LabelPosition   = 0
; 
; Blitz Objects
; -------------------------------------------------------
; Max File        = 5
; Max GadgetList  = 5
; Max Shape       = 100
; Max Bank        = 5
; Max MenuList    = 5
; Max GTList      = 5
; Max Palette     = 4
; Max BitMap      = 10
; Max Screen      = 5
; Max IntuiFont   = 5
; Max Window      = 5
; Max BlitzFont   = 4
; Max IconInfo    = 1
; Max MUIObject   = 50
; Max AsyncReq    = 4
; Max Req-Lib     = 5
; Max GTMenuList  = 5
; Max Console     = 5
; Max TCPSock     = 5
; Max Tape        = 5
; Max Sound       = 10
; Max MedModule   = 8
; Max Buffer      = 10
; Max Queue       = 10
; Max Sprite      = 20
; Max Module      = 5
; Max Slice       = 10
; Max Page        = 4
; Max CopList     = 10
; Max PTModule    = 5
; Max Anim        = 10
; Max NChunky     = 50
; Max Chunky      = 20
; Max Stencil     = 5
; Max XBSound     = 10
; /XTRA
CIAA_PRA	EQU	$BFE001
JOY0DAT		EQU	$DFF00A
JOY1DAT		EQU	$DFF00C
POTGOR		EQU	$DFF016
POTGO		EQU	$DFF034



!libheader{#gameiolib,0,0,0,errors}

!afunction{#word}
!args{#word}
!libs
!subs{do_joyx,errcheck,0}
!name{"Joyx","(Port)"

!afunction{#word}
!args{#word}
!libs
!subs{do_joyy,errcheck,0}
!name{"Joyy","(Port)"

!afunction{#word}
!args{#word}
!libs
!subs{do_joyr,errcheck,0}
!name{"Joyr","(Port)"

!afunction{#word}
!args{#word}
!libs
!subs{do_joyb,errcheck,0}
!name{"Joyb","(Port)"

!afunction{#word}
!args{#word}
!libs
!subs{do_gameb,errcheck,0}
!name{"Gameb","(Port)"}

!libfin

; ==========================================================================================
do_joyx:
	MOVE.w	JOY0DAT,D1		;114: 323900dff00a
	TST.w	D0			;11a: 4a40
	BEQ.w	LAB_0001		;11c: 67000008
	MOVE.w	JOY1DAT,D1		;120: 323900dff00c
LAB_0001:
	MOVEQ	#-1,D0			;126: 70ff
	BTST	#9,D1			;128: 08010009
	BNE.w	LAB_0002		;12c: 6600000e
	MOVEQ	#1,D0			;130: 7001
	BTST	#1,D1			;132: 08010001
	BNE.w	LAB_0002		;136: 66000004
	MOVEQ	#0,D0			;13a: 7000
LAB_0002:
	RTS				;13c: 4e75

do_joyy:
	MOVE.w	JOY0DAT,D1		;13e: 323900dff00a
	TST.w	D0			;144: 4a40
	BEQ.w	LAB_0004		;146: 67000008
	MOVE.w	JOY1DAT,D1		;14a: 323900dff00c
LAB_0004:
	MOVE.w	D1,D2			;150: 3401
	LSR.w	#1,D2			;152: e24a
	EOR.w	D2,D1			;154: b541
	MOVEQ	#-1,D0			;156: 70ff
	BTST	#8,D1			;158: 08010008
	BNE.w	LAB_0005		;15c: 6600000c
	MOVEQ	#1,D0			;160: 7001
	LSR.w	#1,D1			;162: e249
	BCS.w	LAB_0005		;164: 65000004
	MOVEQ	#0,D0			;168: 7000
LAB_0005:
	RTS				;16a: 4e75

do_joyr:
	BSR.w	do_joyx		;16c: 6100ffa6
	AND.w	#$0003,D0		;170: c07c0003
	LSL.w	#1,D0			;174: e348
	MOVE.w	D0,D3			;176: 3600
	BSR.w	LAB_0004		;178: 6100ffd6
	AND.w	#$0003,D0		;17c: c07c0003
	LSL.w	#3,D0			;180: e748
	OR.w	D3,D0			;182: 8043
	MOVE.w	LAB_0007(PC,D0.w),D0	;184: 303b0004
	RTS				;188: 4e75

LAB_0007:
	Dc.w	$0008			;18a
	Dc.w	$0002
	Dc.w	$0008
	Dc.w	$0006
	Dc.w	$0004
	Dc.w	$0003
	Dc.w	$0008
	Dc.w	$0005
	Dc.w	$0008
	Dc.w	$0008			;19c
	Dc.w	$0008			;19e
	Dc.w	$0008			;1a0
	Dc.w	$0000
	Dc.w	$0001
	Dc.w	$0008			;1a6
	Dc.w	$0007			;1a8

do_joyb:
	TST.w	D0			;1aa: 4a40
	BNE.w	LAB_000B		;1ac: 66000024
	MOVEQ	#0,D0			;1b0: 7000
	BTST	#6,CIAA_PRA		;1b2: 0839000600bfe001
	BNE.w	LAB_0009		;1ba: 66000004
	MOVEQ	#1,D0			;1be: 7001
LAB_0009:
	BTST	#2,POTGOR		;1c0: 0839000200dff016
	BNE.w	LAB_000A		;1c8: 66000006
	BSET	#1,D0			;1cc: 08c00001
LAB_000A:
	RTS				;1d0: 4e75

LAB_000B:
	MOVEQ	#0,D0			;1d2: 7000
	BTST	#7,CIAA_PRA		;1d4: 0839000700bfe001
	BNE.w	LAB_000C		;1dc: 66000004
	MOVEQ	#1,D0			;1e0: 7001
LAB_000C:
	MOVE.w	#$c000,POTGO		;1e2: 33fcc00000dff034
	BTST	#6,POTGOR		;1ea: 0839000600dff016
	BNE.w	LAB_000D		;1f2: 66000006
	BSET	#1,D0			;1f6: 08c00001
LAB_000D:
	RTS				;1fa: 4e75

do_gameb:
	LEA	CIAA_PRA,A0		;1fc: 41f900bfe001
	LEA	POTGOR,A1		;202: 43f900dff016
	TST.w	D0			;208: 4a40
	BEQ.w	LAB_0011		;20a: 6700004a
	MOVEQ	#7,D3			;20e: 7607
	MOVE.w	#$4000,D4		;210: 383c4000
	BSET	D3,512(A0)		;214: 07e80200
	BCLR	D3,(A0)			;218: 0790
	MOVE.w	#$2000,POTGO		;21a: 33fc200000dff034
	MOVEQ	#6,D1			;222: 7206
	MOVEQ	#0,D0			;224: 7000
LAB_000F:
	TST.b	(A0)			;226: 4a10
	TST.b	(A0)			;228: 4a10
	TST.b	(A0)			;22a: 4a10
	TST.b	(A0)			;22c: 4a10
	TST.b	(A0)			;22e: 4a10
	TST.b	(A0)			;230: 4a10
	TST.b	(A0)			;232: 4a10
	TST.b	(A0)			;234: 4a10
	MOVE.w	(A1),D2			;236: 3411
	BSET	D3,(A0)			;238: 07d0
	BCLR	D3,(A0)			;23a: 0790
	AND.w	D4,D2			;23c: c444
	BNE.w	LAB_0010		;23e: 66000004
	BSET	D1,D0			;242: 03c0
LAB_0010:
	DBF	D1,LAB_000F		;244: 51c9ffe0
	MOVE.w	#$3000,POTGO		;248: 33fc300000dff034
	BCLR	D3,512(A0)		;250: 07a80200
	RTS				;254: 4e75
LAB_0011:
	MOVEQ	#6,D3			;256: 7606
	MOVE.w	#$0400,D4		;258: 383c0400
	BSET	D3,512(A0)		;25c: 07e80200
	BCLR	D3,(A0)			;260: 0790
	MOVE.w	#$0200,POTGO		;262: 33fc020000dff034
	MOVEQ	#6,D1			;26a: 7206
	MOVEQ	#0,D0			;26c: 7000
	TST.b	(A0)			;26e: 4a10
	TST.b	(A0)			;270: 4a10
	TST.b	(A0)			;272: 4a10
	TST.b	(A0)			;274: 4a10
	TST.b	(A0)			;276: 4a10
	TST.b	(A0)			;278: 4a10
	TST.b	(A0)			;27a: 4a10
	TST.b	(A0)			;27c: 4a10
	MOVE.w	(A1),D2			;27e: 3411
	BSET	D3,(A0)			;280: 07d0
	BCLR	D3,(A0)			;282: 0790
	AND.w	D4,D2			;284: c444
	BNE.w	LAB_0012		;286: 66000004
	BSET	D1,D0			;28a: 03c0
LAB_0012:
	DBF	D1,LAB_000F		;28c: 51c9ff98
	MOVE.w	#$0300,POTGO		;290: 33fc030000dff034
	BCLR	D3,512(A0)		;298: 07a80200
RTS

; ======================================================================================
errors:

errmsg1:	Dc.b	"Joyport must be 0 or 1",0,0
errcheck:
	TST.w	D0 : BEQ.w LAB_0015
	CMPI.w	#$0001,D0 : BEQ.w LAB_0015
		MOVE.l	#errmsg1,D0 : TRAP	#0
	LAB_0015:
RTS
RTS