; XTRA
; Embedded .xtra Header
; 
; General Info
; -------------------------------------------------------
; ExePath         = "C:"
; ExeFile         = "ID3Tag"
; CreateIcon      = 0
; Residents       = "all.res"
; 
; Compiler
; -------------------------------------------------------
; StringBuffer    = 10240
; MakeSmallest    = 1
; FuncOptimize    = 1
; Version         = 0.0.0
; NumberOfBuilds  = 53
; 
; Debugger
; -------------------------------------------------------
; CliArgs         = ""
; StackSize       = 8191
; RuntimeDebug    = 0
; DebugInfo       = 0
; CreateDbgFile   = 0
; OverflowCheck   = 0
; AssemblerCheck  = 0
; InterruptCheck  = 1
; AutoRun         = 1
; 
; Editor
; -------------------------------------------------------
; CursorLine      = 7
; CursorColumn    = 9
; LabelSearch     = ""
; LabelRemark     = 0
; LabelAll        = 0
; LabelPosition   = 0
; 
; Blitz Objects
; -------------------------------------------------------
; Max IconInfo    = 1
; Max NChunky     = 50
; Max MUIObject   = 50
; Max PTModule    = 5
; Max AsyncReq    = 4
; Max Req-Lib     = 5
; Max GTMenuList  = 5
; Max Console     = 5
; Max TCPSock     = 5
; Max XBSound     = 10
; Max Chunky      = 20
; Max File        = 5
; Max GadgetList  = 5
; Max Queue       = 10
; Max Screen      = 5
; Max Shape       = 100
; Max CopList     = 10
; Max Sprite      = 20
; Max Stencil     = 5
; Max Module      = 5
; Max Window      = 20
; Max Anim        = 10
; Max Sound       = 10
; Max Bank        = 5
; Max Buffer      = 10
; Max BitMap      = 10
; Max Slice       = 10
; Max Page        = 4
; Max Tape        = 5
; Max IntuiFont   = 5
; Max MedModule   = 8
; Max Palette     = 4
; Max MenuList    = 5
; Max BlitzFont   = 4
; Max GTList      = 20
; Max ChunkyBuffer= 2
; /XTRA
;///////////////////////////////////////////////////////////////////////////////
;/                                                                             /
;/ Name: ID3Tag.include                                                        /
;/                                                                             /
;/ Platforms: Classic, WinUAE, Amithlon, MorphOS, AmigaOS4                     /
;/                                                                             /
;/ Date: 24/05/2007                                                            /
;/                                                                             /
;/ Author: <unknown>                                                           /
;/                                                                             /
;/ Requirements:  Amiblitz3                                                    /
;/                                                                             /
;/ Purpose:                                                                    /
;/ Extend AB3 functionality.                                                   /
;/ * no description available *                                                /
;/                                                                             /
;/ Abstract:                                                                   /
;/ * no abstract available *                                                   /
;/                                                                             /
;/ User Constants:                                                             /
;/ #max_objects   = n                                                          /
;/                                                                             /
;///////////////////////////////////////////////////////////////////////////////
CNIF #__include=0
OPTIMIZE 5
SYNTAX 2
CEND

XINCLUDE "error.include.ab3"

NEWTYPE.ID3Tag_Image
str_description.l; /* max 64 characters, can be NULL */
str_mime.l;
;    '-->' Data is a LINK To the File
;    'image/jpeg' Data is binary
;    'image/png' Data is binary
size.l; /* size of data >0 */
ptr_data.l; /* pointer to the data (binary or URL) */
End NEWTYPE
#ID3Tag_MINVERSION = 1
#ID3Tag_NOERROR = 0

#ID3Tag_Dummy = (#TAG_USER)

#ID3Tag_Title                   = (#ID3Tag_Dummy+1) ; /* STRPTR */
#ID3Tag_Artist                  = (#ID3Tag_Dummy+2) ; /* STRPTR */
#ID3Tag_Album                   = (#ID3Tag_Dummy+3) ; /* STRPTR */
#ID3Tag_Year                    = (#ID3Tag_Dummy+4) ; /* STRPTR */
#ID3Tag_Comment                 = (#ID3Tag_Dummy+5) ; /* STRPTR */
#ID3Tag_Genre                   = (#ID3Tag_Dummy+6) ; /* STRPTR */
#ID3Tag_Track                   = (#ID3Tag_Dummy+7) ; /* LONG */
#ID3Tag_Comment2                = (#ID3Tag_Dummy+8) ; /* STRPTR (multiline) */
#ID3Tag_Track2                  = (#ID3Tag_Dummy+9) ; /* LONG */
; /* id3tag.library v3.0 */
#ID3Tag_TextWriter              = (#ID3Tag_Dummy+10) ; /* STRPTR */
#ID3Tag_EncodedBy               = (#ID3Tag_Dummy+11) ; /* STRPTR */
#ID3Tag_Publisher               = (#ID3Tag_Dummy+12) ; /* STRPTR */
#ID3Tag_OriginalYear            = (#ID3Tag_Dummy+13) ; /* STRPTR */
#ID3Tag_OriginalArtist          = (#ID3Tag_Dummy+14) ; /* STRPTR */
#ID3Tag_OriginalTextWriter      = (#ID3Tag_Dummy+15) ; /* STRPTR */
#ID3Tag_OriginalAlbum           = (#ID3Tag_Dummy+16) ; /* STRPTR */
#ID3Tag_OriginalFileName        = (#ID3Tag_Dummy+17) ; /* STRPTR */
#ID3Tag_URLArtist               = (#ID3Tag_Dummy+18) ; /* STRPTR */
#ID3Tag_URLPublisher            = (#ID3Tag_Dummy+19) ; /* STRPTR */
#ID3Tag_URLAudiofile            = (#ID3Tag_Dummy+20) ; /* STRPTR */
#ID3Tag_URLUser                 = (#ID3Tag_Dummy+21) ; /* STRPTR */
#ID3Tag_URLUserDescription      = (#ID3Tag_Dummy+22) ; /* STRPTR */
#ID3Tag_Composer                = (#ID3Tag_Dummy+23) ; /* STRPTR */
#ID3Tag_BPM                     = (#ID3Tag_Dummy+24) ; /* LONG */
#ID3Tag_Copyright               = (#ID3Tag_Dummy+25) ; /* STRPTR */
#ID3Tag_URLCopyright            = (#ID3Tag_Dummy+26) ; /* STRPTR */
#ID3Tag_Subtitle                = (#ID3Tag_Dummy+27) ; /* STRPTR */
#ID3Tag_Conductor               = (#ID3Tag_Dummy+28) ; /* STRPTR */
#ID3Tag_ContentGroupDescription = (#ID3Tag_Dummy+29) ; /* STRPTR */
#ID3Tag_Accompaniment           = (#ID3Tag_Dummy+30) ; /* STRPTR */
; /* id3tag.library v4.1 */
#ID3Tag_LyricsText              = (#ID3Tag_Dummy+31) ; /* STRPTR (multiline) */
#ID3Tag_LyricsDescriptor        = (#ID3Tag_Dummy+32) ; /* STRPTR */
; /* id3tag.library v4.2 */
#ID3Tag_LyricsLanguage          = (#ID3Tag_Dummy+33) ; /* STRPTR (language id) */
#ID3Tag_CommentLanguage         = (#ID3Tag_Dummy+34) ; /* STRPTR (language id) */
; /* id3tag.library v5.0 */
#ID3Tag_ImageOther              = (#ID3Tag_Dummy+35) ; /* Pointer To ID3Tag_Image OR Null */
#ID3Tag_ImageCoverFront         = (#ID3Tag_Dummy+36) ; /* Pointer To ID3Tag_Image OR Null */
#ID3Tag_ImageCoverBack          = (#ID3Tag_Dummy+37) ; /* Pointer To ID3Tag_Image OR Null */
#ID3Tag_ImageLeaflet            = (#ID3Tag_Dummy+38) ; /* Pointer To ID3Tag_Image OR Null */
#ID3Tag_ImageMedia              = (#ID3Tag_Dummy+39) ; /* Pointer To ID3Tag_Image OR Null */
#ID3Tag_ImageLeadArtist         = (#ID3Tag_Dummy+40) ; /* Pointer To ID3Tag_Image OR Null */
#ID3Tag_ImageArtist             = (#ID3Tag_Dummy+41) ; /* Pointer To ID3Tag_Image OR Null */
#ID3Tag_ImageConductor          = (#ID3Tag_Dummy+42) ; /* Pointer To ID3Tag_Image OR Null */
#ID3Tag_ImageBand               = (#ID3Tag_Dummy+43) ; /* Pointer To ID3Tag_Image OR Null */
#ID3Tag_ImageComposer           = (#ID3Tag_Dummy+44) ; /* Pointer To ID3Tag_Image OR Null */
#ID3Tag_ImageTextWriter         = (#ID3Tag_Dummy+45) ; /* Pointer To ID3Tag_Image OR Null */
#ID3Tag_ImageRecordingLocation  = (#ID3Tag_Dummy+46) ; /* Pointer To ID3Tag_Image OR Null */
#ID3Tag_ImageDuringRecording    = (#ID3Tag_Dummy+47) ; /* Pointer To ID3Tag_Image OR Null */
#ID3Tag_ImageDuringPerformance  = (#ID3Tag_Dummy+48) ; /* Pointer To ID3Tag_Image OR Null */
#ID3Tag_ImageMovie              = (#ID3Tag_Dummy+49) ; /* Pointer To ID3Tag_Image OR Null */
#ID3Tag_ImageIllustration       = (#ID3Tag_Dummy+50) ; /* Pointer To ID3Tag_Image OR Null */
#ID3Tag_ImageLogo               = (#ID3Tag_Dummy+51) ; /* Pointer To ID3Tag_Image OR Null */
#ID3Tag_ImagePublisher          = (#ID3Tag_Dummy+52) ; /* Pointer To ID3Tag_Image OR Null */

#_LVOID3Tag_Alloc         = -30
#_LVOID3Tag_Free          = -36
#_LVOID3Tag_Read          = -42
#_LVOID3Tag_Write         = -48
#_LVOID3Tag_SetAttrsA     = -54
#_LVOID3Tag_GetAttrsA     = -60
#_LVOID3Tag_Remove        = -66
#_LVOID3Tag_Clear         = -72
#_LVOID3Tag_RemoveType    = -78
#_LVOID3Tag_ReadVersion   = -84
#_LVOID3Tag_WriteVersion  = -90
#_LVOID3Tag_ReadTagV2     = -96
#_LVOID3Tag_WriteTagV2    = -102
#_LVOID3Tag_Tag2Buffer    = -108
#_LVOID3Tag_Buffer2Tag    = -114
#_LVOID3Tag_ReloadPrefsA  = -120
#_LVOID3Tag_LaunchPrefsA  = -126

;DEFTYPE.Library *ID3TagBase
SHARED *ID3TagBase.Library,hID3Tag.l


; Library wrapper macros
;///////////////////////////////////////////////////////////////////////////////
;/                                                                             /
;/ Syntax: !_ID3Tag_RescueRegs                                                 /
;/                                                                             /
;/ Description:                                                                /
;/ * no description available *                                                /
;/                                                                             /
;///////////////////////////////////////////////////////////////////////////////
Macro _ID3Tag_RescueRegs
MOVE.l a5,-(a7) : MOVE.l a6,-(a7) : MOVE.l d7,-(a7)
End Macro

;///////////////////////////////////////////////////////////////////////////////
;/                                                                             /
;/ Syntax: !_ID3Tag_RestoreRegs                                                /
;/                                                                             /
;/ Description:                                                                /
;/ * no description available *                                                /
;/                                                                             /
;///////////////////////////////////////////////////////////////////////////////
Macro _ID3Tag_RestoreRegs
MOVE.l (a7)+,d7 : MOVE.l (a7)+,a6 : MOVE.l (a7)+,a5
End Macro

;///////////////////////////////////////////////////////////////////////////////
;/                                                                             /
;/ Syntax: !ID3Tag_Alloc {hID3Tag.l}                                           /
;/                                                                             /
;/ Description:                                                                /
;/ * no description available *                                                /
;/                                                                             /
;/ Inputs:                                                                     /
;/ - hID3Tag.l    : ???                                                        /
;/                                                                             /
;///////////////////////////////////////////////////////////////////////////////
Macro ID3Tag_Alloc ; {hID3Tag.l}
;()()
!_ID3Tag_RescueRegs
GetReg a6,*ID3TagBase
JSR _LVOID3Tag_Alloc(a6)
!_ID3Tag_RestoreRegs
`1 = PutRegD0
End Macro

;///////////////////////////////////////////////////////////////////////////////
;/                                                                             /
;/ Syntax: !ID3Tag_Free {hID3Tag.l}                                            /
;/                                                                             /
;/ Description:                                                                /
;/ * no description available *                                                /
;/                                                                             /
;/ Inputs:                                                                     /
;/ - hID3Tag.l    : ???                                                        /
;/                                                                             /
;///////////////////////////////////////////////////////////////////////////////
Macro ID3Tag_Free ; {hID3Tag.l}
;(id3tag)(d0)
GetReg d0,`1
!_ID3Tag_RescueRegs
GetReg a6,*ID3TagBase
JSR _LVOID3Tag_Alloc(a6)
!_ID3Tag_RestoreRegs
End Macro

;///////////////////////////////////////////////////////////////////////////////
;/                                                                             /
;/ Syntax: !ID3Tag_Read {err.l,hID3Tag.l,filename.s}                           /
;/                                                                             /
;/ Description:                                                                /
;/ * no description available *                                                /
;/                                                                             /
;/ Inputs:                                                                     /
;/ - err.l    : ???                                                            /
;/ - hID3Tag.l    : ???                                                        /
;/ - filename.s    : ???                                                       /
;/                                                                             /
;///////////////////////////////////////////////////////////////////////////////
Macro ID3Tag_Read ; {err.l,hID3Tag.l,filename.s}
;(id3tag,File)(d0,d1)
GetReg d0,`2
GetReg d1,`3
!_ID3Tag_RescueRegs
GetReg a6,*ID3TagBase
JSR _LVOID3Tag_Read(a6)
!_ID3Tag_RestoreRegs
`1 = PutRegD0
End Macro

;///////////////////////////////////////////////////////////////////////////////
;/                                                                             /
;/ Syntax: !ID3Tag_Write {err.l,hID3Tag.l,filename.s}                          /
;/                                                                             /
;/ Description:                                                                /
;/ * no description available *                                                /
;/                                                                             /
;/ Inputs:                                                                     /
;/ - err.l    : ???                                                            /
;/ - hID3Tag.l    : ???                                                        /
;/ - filename.s    : ???                                                       /
;/                                                                             /
;///////////////////////////////////////////////////////////////////////////////
Macro ID3Tag_Write ; {err.l,hID3Tag.l,filename.s}
;(id3tag,File)(d0,d1)
GetReg d0,`2
GetReg d1,`3
!_ID3Tag_RescueRegs
GetReg a6,*ID3TagBase
JSR _LVOID3Tag_Write(a6)
!_ID3Tag_RestoreRegs
`1 = PutRegD0
End Macro

;///////////////////////////////////////////////////////////////////////////////
;/                                                                             /
;/ Syntax: !ID3Tag_SetAttrsA {count.l,hID3Tag.l,*taglist.TagItem}              /
;/                                                                             /
;/ Description:                                                                /
;/ * no description available *                                                /
;/                                                                             /
;/ Inputs:                                                                     /
;/ - count.l    : ???                                                          /
;/ - hID3Tag.l    : ???                                                        /
;/ - *taglist.TagItem    : ???                                                 /
;/                                                                             /
;///////////////////////////////////////////////////////////////////////////////
Macro ID3Tag_SetAttrsA ; {count.l,hID3Tag.l,*taglist.TagItem}
;(id3tag,tagList)(d0,d1)
GetReg d0,`2 ; id3
GetReg d1,`3 ; taglist
!_ID3Tag_RescueRegs
GetReg a6,*ID3TagBase
JSR _LVOID3Tag_SetAttrsA(a6)
!_ID3Tag_RestoreRegs
`1 = PutRegD0
End Macro

;///////////////////////////////////////////////////////////////////////////////
;/                                                                             /
;/ Syntax: !ID3Tag_GetAttrsA {count.l,hID3Tag.l,*taglist.TagItem}              /
;/                                                                             /
;/ Description:                                                                /
;/ * no description available *                                                /
;/                                                                             /
;/ Inputs:                                                                     /
;/ - count.l    : ???                                                          /
;/ - hID3Tag.l    : ???                                                        /
;/ - *taglist.TagItem    : ???                                                 /
;/                                                                             /
;///////////////////////////////////////////////////////////////////////////////
Macro ID3Tag_GetAttrsA  ; {count.l,hID3Tag.l,*taglist.TagItem}
;(id3tag,taglist)(d0,d1)
GetReg d0,`2 ; id3
GetReg d1,`3 ; taglist
!_ID3Tag_RescueRegs
GetReg a6,*ID3TagBase
JSR _LVOID3Tag_GetAttrsA(a6)
!_ID3Tag_RestoreRegs
`1 = PutRegD0
End Macro

;///////////////////////////////////////////////////////////////////////////////
;/                                                                             /
;/ Syntax: !ID3Tag_Remove {err.l,hID3Tag.l,filename.s}                         /
;/                                                                             /
;/ Description:                                                                /
;/ * no description available *                                                /
;/                                                                             /
;/ Inputs:                                                                     /
;/ - err.l    : ???                                                            /
;/ - hID3Tag.l    : ???                                                        /
;/ - filename.s    : ???                                                       /
;/                                                                             /
;///////////////////////////////////////////////////////////////////////////////
Macro ID3Tag_Remove ; {err.l,hID3Tag.l,filename.s}
;(id3tag,File)(d0,d1)
GetReg d0,`2
GetReg d1,`3
!_ID3Tag_RescueRegs
GetReg a6,*ID3TagBase
JSR _LVOID3Tag_Write(a6)
!_ID3Tag_RestoreRegs
`1 = PutRegD0
End Macro

;///////////////////////////////////////////////////////////////////////////////
;/                                                                             /
;/ Syntax: !ID3Tag_Clear {err.l,hID3Tag.l}                                     /
;/                                                                             /
;/ Description:                                                                /
;/ * no description available *                                                /
;/                                                                             /
;/ Inputs:                                                                     /
;/ - err.l    : ???                                                            /
;/ - hID3Tag.l    : ???                                                        /
;/                                                                             /
;///////////////////////////////////////////////////////////////////////////////
Macro ID3Tag_Clear ; {err.l,hID3Tag.l}
;(id3tag)(d0)
GetReg d0,`1
!_ID3Tag_RescueRegs
GetReg a6,*ID3TagBase
JSR _LVOID3Tag_Clear(a6)
!_ID3Tag_RestoreRegs
`1 = PutRegD0
End Macro

;///////////////////////////////////////////////////////////////////////////////
;/                                                                             /
;/ Syntax: !ID3Tag_RemoveType                                                  /
;/                                                                             /
;/ Description:                                                                /
;/ * no description available *                                                /
;/                                                                             /
;///////////////////////////////////////////////////////////////////////////////
Macro ID3Tag_RemoveType
;(id3tag,File,Type)(d0,d1,d2)
End Macro

;///////////////////////////////////////////////////////////////////////////////
;/                                                                             /
;/ Syntax: !ID3Tag_ReadVersion                                                 /
;/                                                                             /
;/ Description:                                                                /
;/ * no description available *                                                /
;/                                                                             /
;///////////////////////////////////////////////////////////////////////////////
Macro ID3Tag_ReadVersion
;(id3tag,File,version)(d0,d1,d2)
End Macro

;///////////////////////////////////////////////////////////////////////////////
;/                                                                             /
;/ Syntax: !ID3Tag_WriteVersion                                                /
;/                                                                             /
;/ Description:                                                                /
;/ * no description available *                                                /
;/                                                                             /
;///////////////////////////////////////////////////////////////////////////////
Macro ID3Tag_WriteVersion
;(id3tag,File,version)(d0,d1,d2)
End Macro

;///////////////////////////////////////////////////////////////////////////////
;/                                                                             /
;/ Syntax: !ID3Tag_ReadTagV2                                                   /
;/                                                                             /
;/ Description:                                                                /
;/ * no description available *                                                /
;/                                                                             /
;///////////////////////////////////////////////////////////////////////////////
Macro ID3Tag_ReadTagV2
;(id3tag,File)(d0,d1)
End Macro

;///////////////////////////////////////////////////////////////////////////////
;/                                                                             /
;/ Syntax: !ID3Tag_WriteTagV2                                                  /
;/                                                                             /
;/ Description:                                                                /
;/ * no description available *                                                /
;/                                                                             /
;///////////////////////////////////////////////////////////////////////////////
Macro ID3Tag_WriteTagV2
;(id3tag,File,padding)(d0,d1,d2)
End Macro

;///////////////////////////////////////////////////////////////////////////////
;/                                                                             /
;/ Syntax: !ID3Tag_Tag2Buffer                                                  /
;/                                                                             /
;/ Description:                                                                /
;/ * no description available *                                                /
;/                                                                             /
;///////////////////////////////////////////////////////////////////////////////
Macro ID3Tag_Tag2Buffer
;(id3tag,Buffer,buffersize,padding,version)(d0,d1,d2,a0,a1)
End Macro

;///////////////////////////////////////////////////////////////////////////////
;/                                                                             /
;/ Syntax: !ID3Tag_Buffer2Tag                                                  /
;/                                                                             /
;/ Description:                                                                /
;/ * no description available *                                                /
;/                                                                             /
;///////////////////////////////////////////////////////////////////////////////
Macro ID3Tag_Buffer2Tag
;(id3tag,Buffer,buffersize)(d0,d1,d2)
End Macro

;///////////////////////////////////////////////////////////////////////////////
;/                                                                             /
;/ Syntax: !ID3Tag_ReLoadPrefs                                                 /
;/                                                                             /
;/ Description:                                                                /
;/ * no description available *                                                /
;/                                                                             /
;///////////////////////////////////////////////////////////////////////////////
Macro ID3Tag_ReLoadPrefs
;()()
End Macro

;///////////////////////////////////////////////////////////////////////////////
;/                                                                             /
;/ Syntax: !ID3Tag_LaunchPrefsA                                                /
;/                                                                             /
;/ Description:                                                                /
;/ * no description available *                                                /
;/                                                                             /
;///////////////////////////////////////////////////////////////////////////////
Macro ID3Tag_LaunchPrefsA
;(taglist)(d0)
End Macro


;///////////////////////////////////////////////////////////////////////////////
;/                                                                             /
;/ Syntax:  result.s = id3_GetTagString {tagid.l,@defstring.s}                 /
;/                                                                             /
;/ Description:                                                                /
;/ * no description available *                                                /
;/                                                                             /
;/ Inputs:                                                                     /
;/ - tagid.l    : ???                                                          /
;/ - defstring.s    : ???                                                      /
;/                                                                             /
;/ Result:                                                                     /
;/ - result.s     : ???                                                        /
;/                                                                             /
;///////////////////////////////////////////////////////////////////////////////
Function.s id3_GetTagString {tagid.l,@defstring.s}
If hID3Tag = 0 Then Function Return defstring
!ID3Tag_GetAttrsA {err.l,hID3Tag,Tags(tagid,&strptr.l)}
If err=#ID3Tag_NOERROR
  If strptr Then a.s = Peek.s(strptr) : Else a.s = defstring
  While Left$(a.s,1) = " ":a.s = Right$(a.s,FLen(a.s)-1):Wend
  While Right$(a.s,1) = " ":a.s = Left$(a.s,FLen(a.s)-1):Wend
  a.s = Replace$(a.s,"\r","")
  For n.l=0 To Len(a.s)-1
    If Peek.b(&a.s+n)>=0 AND Peek.b(&a.s+n)<32
     Poke.b &a.s+n,@"_"
    End If
  Next
Else
  a.s = defstring.s
End If
Function Return a.s
End Function


;///////////////////////////////////////////////////////////////////////////////
;/                                                                             /
;/ Syntax:  result.l = id3_SetTagString {tagid.l,string.s}                     /
;/                                                                             /
;/ Description:                                                                /
;/ * no description available *                                                /
;/                                                                             /
;/ Inputs:                                                                     /
;/ - tagid.l    : ???                                                          /
;/ - string.s    : ???                                                         /
;/                                                                             /
;/ Result:                                                                     /
;/ - result.l     : ???                                                        /
;/                                                                             /
;///////////////////////////////////////////////////////////////////////////////
Function.l id3_SetTagString {tagid.l,string.s}
If hID3Tag = 0 Then Function Return False
!ID3Tag_SetAttrsA {err.l,hID3Tag,Tags(tagid,&string)}
If err=#ID3Tag_NOERROR Then succ.l=True:Else succ=False
Function Return succ
End Function


;///////////////////////////////////////////////////////////////////////////////
;/                                                                             /
;/ Syntax:  result.l = id3_SetTagValue {tagid.l,value.l}                       /
;/                                                                             /
;/ Description:                                                                /
;/ * no description available *                                                /
;/                                                                             /
;/ Inputs:                                                                     /
;/ - tagid.l    : ???                                                          /
;/ - value.l    : ???                                                          /
;/                                                                             /
;/ Result:                                                                     /
;/ - result.l     : ???                                                        /
;/                                                                             /
;///////////////////////////////////////////////////////////////////////////////
Function.l id3_SetTagValue {tagid.l,value.l}
If hID3Tag = 0 Then Function Return False
!ID3Tag_SetAttrsA {err.l,hID3Tag,Tags(tagid,value)}
If err=#ID3Tag_NOERROR Then succ.l=True:Else succ=False
Function Return succ
End Function


;///////////////////////////////////////////////////////////////////////////////
;/                                                                             /
;/ Syntax:  result.l = id3_GetTagValue {tagid.l,@defvalue.l}                   /
;/                                                                             /
;/ Description:                                                                /
;/ * no description available *                                                /
;/                                                                             /
;/ Inputs:                                                                     /
;/ - tagid.l    : ???                                                          /
;/ - defvalue.l    : ???                                                       /
;/                                                                             /
;/ Result:                                                                     /
;/ - result.l     : ???                                                        /
;/                                                                             /
;///////////////////////////////////////////////////////////////////////////////
Function.l id3_GetTagValue {tagid.l,@defvalue.l}
If hID3Tag = 0 Then Function Return defvalue
value.l = defvalue
!ID3Tag_GetAttrsA {err.l,hID3Tag,Tags(tagid,&value.l)}
If err=#ID3Tag_NOERROR AND value><0
  ;-)
Else
  value = defvalue
End If
Function Return value
End Function

;///////////////////////////////////////////////////////////////////////////////
;/                                                                             /
;/ Syntax:  result.s = id3_GetTitle {}                                         /
;/                                                                             /
;/ Description:                                                                /
;/ * no description available *                                                /
;/                                                                             /
;/ Result:                                                                     /
;/ - result.s     : ???                                                        /
;/                                                                             /
;///////////////////////////////////////////////////////////////////////////////
Function.s id3_GetTitle{}
Function Return id3_GetTagString{#ID3Tag_Title}
End Function

;///////////////////////////////////////////////////////////////////////////////
;/                                                                             /
;/ Syntax:  result.s = id3_GetArtist {}                                        /
;/                                                                             /
;/ Description:                                                                /
;/ * no description available *                                                /
;/                                                                             /
;/ Result:                                                                     /
;/ - result.s     : ???                                                        /
;/                                                                             /
;///////////////////////////////////////////////////////////////////////////////
Function.s id3_GetArtist{}
Function Return id3_GetTagString{#ID3Tag_Artist}
End Function
 
;///////////////////////////////////////////////////////////////////////////////
;/                                                                             /
;/ Syntax:  result.s = id3_GetAlbum {}                                         /
;/                                                                             /
;/ Description:                                                                /
;/ * no description available *                                                /
;/                                                                             /
;/ Result:                                                                     /
;/ - result.s     : ???                                                        /
;/                                                                             /
;///////////////////////////////////////////////////////////////////////////////
Function.s id3_GetAlbum{}
Function Return id3_GetTagString{#ID3Tag_Album}
End Function

;///////////////////////////////////////////////////////////////////////////////
;/                                                                             /
;/ Syntax:  result.s = id3_GetYear {}                                          /
;/                                                                             /
;/ Description:                                                                /
;/ * no description available *                                                /
;/                                                                             /
;/ Result:                                                                     /
;/ - result.s     : ???                                                        /
;/                                                                             /
;///////////////////////////////////////////////////////////////////////////////
Function.s id3_GetYear{}
Function Return id3_GetTagString{#ID3Tag_Year}
End Function
 
;///////////////////////////////////////////////////////////////////////////////
;/                                                                             /
;/ Syntax:  result.s = id3_GetComment {}                                       /
;/                                                                             /
;/ Description:                                                                /
;/ * no description available *                                                /
;/                                                                             /
;/ Result:                                                                     /
;/ - result.s     : ???                                                        /
;/                                                                             /
;///////////////////////////////////////////////////////////////////////////////
Function.s id3_GetComment{}
Function Return id3_GetTagString{#ID3Tag_Comment}
End Function

;///////////////////////////////////////////////////////////////////////////////
;/                                                                             /
;/ Syntax:  result.s = id3_GetLongComment {}                                   /
;/                                                                             /
;/ Description:                                                                /
;/ * no description available *                                                /
;/                                                                             /
;/ Result:                                                                     /
;/ - result.s     : ???                                                        /
;/                                                                             /
;///////////////////////////////////////////////////////////////////////////////
Function.s id3_GetLongComment{}
Function Return id3_GetTagString{#ID3Tag_Comment2}
End Function

;///////////////////////////////////////////////////////////////////////////////
;/                                                                             /
;/ Syntax:  result.s = id3_GetGenre {}                                         /
;/                                                                             /
;/ Description:                                                                /
;/ * no description available *                                                /
;/                                                                             /
;/ Result:                                                                     /
;/ - result.s     : ???                                                        /
;/                                                                             /
;///////////////////////////////////////////////////////////////////////////////
Function.s id3_GetGenre{}
Function Return id3_GetTagString{#ID3Tag_Genre}
End Function

;///////////////////////////////////////////////////////////////////////////////
;/                                                                             /
;/ Syntax:  result.l = id3_GetTrack {}                                         /
;/                                                                             /
;/ Description:                                                                /
;/ * no description available *                                                /
;/                                                                             /
;/ Result:                                                                     /
;/ - result.l     : ???                                                        /
;/                                                                             /
;///////////////////////////////////////////////////////////////////////////////
Function.l id3_GetTrack{}
Function Return id3_GetTagValue{#ID3Tag_Track}
End Function
 
;///////////////////////////////////////////////////////////////////////////////
;/                                                                             /
;/ Syntax:  result.l = id3_SetTitle {title.s}                                  /
;/                                                                             /
;/ Description:                                                                /
;/ * no description available *                                                /
;/                                                                             /
;/ Inputs:                                                                     /
;/ - title.s    : ???                                                          /
;/                                                                             /
;/ Result:                                                                     /
;/ - result.l     : ???                                                        /
;/                                                                             /
;///////////////////////////////////////////////////////////////////////////////
Function.l id3_SetTitle{title.s}
Function Return id3_SetTagString{#ID3Tag_Title,title}
End Function

;///////////////////////////////////////////////////////////////////////////////
;/                                                                             /
;/ Syntax:  result.l = id3_SetArtist {artist.s}                                /
;/                                                                             /
;/ Description:                                                                /
;/ * no description available *                                                /
;/                                                                             /
;/ Inputs:                                                                     /
;/ - artist.s    : ???                                                         /
;/                                                                             /
;/ Result:                                                                     /
;/ - result.l     : ???                                                        /
;/                                                                             /
;///////////////////////////////////////////////////////////////////////////////
Function.l id3_SetArtist{artist.s}
Function Return id3_SetTagString{#ID3Tag_Artist,artist}
End Function

;///////////////////////////////////////////////////////////////////////////////
;/                                                                             /
;/ Syntax:  result.l = id3_SetAlbum {album.s}                                  /
;/                                                                             /
;/ Description:                                                                /
;/ * no description available *                                                /
;/                                                                             /
;/ Inputs:                                                                     /
;/ - album.s    : ???                                                          /
;/                                                                             /
;/ Result:                                                                     /
;/ - result.l     : ???                                                        /
;/                                                                             /
;///////////////////////////////////////////////////////////////////////////////
Function.l id3_SetAlbum{album.s}
Function Return id3_SetTagString{#ID3Tag_Album,album}
End Function

;///////////////////////////////////////////////////////////////////////////////
;/                                                                             /
;/ Syntax:  result.l = id3_SetYear {year.s}                                    /
;/                                                                             /
;/ Description:                                                                /
;/ * no description available *                                                /
;/                                                                             /
;/ Inputs:                                                                     /
;/ - year.s    : ???                                                           /
;/                                                                             /
;/ Result:                                                                     /
;/ - result.l     : ???                                                        /
;/                                                                             /
;///////////////////////////////////////////////////////////////////////////////
Function.l id3_SetYear{year.s}
Function Return id3_SetTagString{#ID3Tag_Year,year}
End Function

;///////////////////////////////////////////////////////////////////////////////
;/                                                                             /
;/ Syntax:  result.l = id3_SetComment {comment.s}                              /
;/                                                                             /
;/ Description:                                                                /
;/ * no description available *                                                /
;/                                                                             /
;/ Inputs:                                                                     /
;/ - comment.s    : ???                                                        /
;/                                                                             /
;/ Result:                                                                     /
;/ - result.l     : ???                                                        /
;/                                                                             /
;///////////////////////////////////////////////////////////////////////////////
Function.l id3_SetComment{comment.s}
Function Return id3_SetTagString{#ID3Tag_Comment,comment}
End Function

;///////////////////////////////////////////////////////////////////////////////
;/                                                                             /
;/ Syntax:  result.l = id3_SetLongComment {comment.s}                          /
;/                                                                             /
;/ Description:                                                                /
;/ * no description available *                                                /
;/                                                                             /
;/ Inputs:                                                                     /
;/ - comment.s    : ???                                                        /
;/                                                                             /
;/ Result:                                                                     /
;/ - result.l     : ???                                                        /
;/                                                                             /
;///////////////////////////////////////////////////////////////////////////////
Function.l id3_SetLongComment{comment.s}
Function Return id3_SetTagString{#ID3Tag_Comment2,comment}
End Function

;///////////////////////////////////////////////////////////////////////////////
;/                                                                             /
;/ Syntax:  result.l = id3_SetGenre {genre.s}                                  /
;/                                                                             /
;/ Description:                                                                /
;/ * no description available *                                                /
;/                                                                             /
;/ Inputs:                                                                     /
;/ - genre.s    : ???                                                          /
;/                                                                             /
;/ Result:                                                                     /
;/ - result.l     : ???                                                        /
;/                                                                             /
;///////////////////////////////////////////////////////////////////////////////
Function.l id3_SetGenre{genre.s}
Function Return id3_SetTagString{#ID3Tag_Genre,genre}
End Function

;///////////////////////////////////////////////////////////////////////////////
;/                                                                             /
;/ Syntax:  result.l = id3_SetTrack {track.l}                                  /
;/                                                                             /
;/ Description:                                                                /
;/ * no description available *                                                /
;/                                                                             /
;/ Inputs:                                                                     /
;/ - track.l    : ???                                                          /
;/                                                                             /
;/ Result:                                                                     /
;/ - result.l     : ???                                                        /
;/                                                                             /
;///////////////////////////////////////////////////////////////////////////////
Function.l id3_SetTrack{track.l}
Function Return id3_SetTagValue{#ID3Tag_Track,track}
End Function


;///////////////////////////////////////////////////////////////////////////////
;/                                                                             /
;/ Syntax:  result.s = id3_GetTagImageInfo {tagid.l,@defstring.s}              /
;/                                                                             /
;/ Description:                                                                /
;/ * no description available *                                                /
;/                                                                             /
;/ Inputs:                                                                     /
;/ - tagid.l    : ???                                                          /
;/ - defstring.s    : ???                                                      /
;/                                                                             /
;/ Result:                                                                     /
;/ - result.s     : ???                                                        /
;/                                                                             /
;///////////////////////////////////////////////////////////////////////////////
Function.s id3_GetTagImageInfo {tagid.l,@defstring.s}
DEFTYPE.ID3Tag_Image img
If hID3Tag = 0 Then Function Return defstring
!ID3Tag_GetAttrsA {err.l,hID3Tag,Tags(tagid,&img)}
If err=#ID3Tag_NOERROR
  If img\str_description Then a.s = Peek.s(img\str_description) : Else a.s = defstring
  While Left$(a.s,1) = " ":a.s = Right$(a.s,FLen(a.s)-1):Wend
  While Right$(a.s,1) = " ":a.s = Left$(a.s,FLen(a.s)-1):Wend
End If
If img\ptr_data><0 Then a.s + " (+binary)"
Function Return a.s
End Function


;///////////////////////////////////////////////////////////////////////////////
;/                                                                             /
;/ Syntax: id3_Free {}                                                         /
;/                                                                             /
;/ Description:                                                                /
;/ * no description available *                                                /
;/                                                                             /
;///////////////////////////////////////////////////////////////////////////////
Statement id3_Free{}
If hID3Tag Then !ID3Tag_Free{hID3Tag} : hID3Tag = 0
If *ID3TagBase Then CloseLibrary_ *ID3TagBase : *ID3TagBase = 0
End Statement
!autoexit{id3_Free}


;///////////////////////////////////////////////////////////////////////////////
;/                                                                             /
;/ Syntax:  result.l = id3_Init {}                                             /
;/                                                                             /
;/ Description:                                                                /
;/ * no description available *                                                /
;/                                                                             /
;/ Result:                                                                     /
;/ - result.l     : ???                                                        /
;/                                                                             /
;///////////////////////////////////////////////////////////////////////////////
Function.l id3_Init{}
SHARED *ID3TagBase
If *ID3TagBase=0 Then *ID3TagBase = OpenLibrary_("id3tag.library",#ID3Tag_MINVERSION)
If *ID3TagBase
  If hID3Tag=0
    !ID3Tag_Alloc{hID3Tag.l}
  End If
Else
  error {"Please install id3tag.library v"+Str$(#ID3Tag_MINVERSION)+".0+!"}
End If
Function Return hID3Tag
End Function


;///////////////////////////////////////////////////////////////////////////////
;/                                                                             /
;/ Syntax:  result.l = id3_ReadTags {filename.s}                               /
;/                                                                             /
;/ Description:                                                                /
;/ * no description available *                                                /
;/                                                                             /
;/ Inputs:                                                                     /
;/ - filename.s    : ???                                                       /
;/                                                                             /
;/ Result:                                                                     /
;/ - result.l     : ???                                                        /
;/                                                                             /
;///////////////////////////////////////////////////////////////////////////////
Function.l id3_ReadTags{filename.s}
If id3_Init{} = False Then Function Return False
!ID3Tag_Read{err.l,hID3Tag,&filename}
If err=#ID3Tag_NOERROR Then succ.l=True:Else succ=False
Function Return succ
End Function


;///////////////////////////////////////////////////////////////////////////////
;/                                                                             /
;/ Syntax:  result.l = id3_WriteTags {filename.s}                              /
;/                                                                             /
;/ Description:                                                                /
;/ * no description available *                                                /
;/                                                                             /
;/ Inputs:                                                                     /
;/ - filename.s    : ???                                                       /
;/                                                                             /
;/ Result:                                                                     /
;/ - result.l     : ???                                                        /
;/                                                                             /
;///////////////////////////////////////////////////////////////////////////////
Function.l id3_WriteTags{filename.s}
If id3_Init{} = False Then Function Return False
!ID3Tag_Write{err.l,hID3Tag,&filename}
If err=#ID3Tag_NOERROR Then succ.l=True:Else succ=False
Function Return succ
End Function


;///////////////////////////////////////////////////////////////////////////////
;/                                                                             /
;/ Syntax:  result.l = id3_CreateNewTags {}                                    /
;/                                                                             /
;/ Description:                                                                /
;/ * no description available *                                                /
;/                                                                             /
;/ Result:                                                                     /
;/ - result.l     : ???                                                        /
;/                                                                             /
;///////////////////////////////////////////////////////////////////////////////
Function.l id3_CreateNewTags{}
If id3_Init{} = False Then Function Return False
!ID3Tag_Clear{err.l,hID3Tag}
If err=#ID3Tag_NOERROR Then succ.l=True:Else succ=False
Function Return succ
End Function
 

CNIF #__include=0
If NumPars<1
  NPrint "Usage: ID3Tag <filename>"
  NPrint "Read out the ID3 tags (including V2) of an mp3 file."
  End
End If
a.s = Par$(1)
If id3_ReadTags{a.s}
  NPrint "File             : ", a.s
  NPrint "Title            : ", id3_GetTagString{#ID3Tag_Title      ,"n/a"}
  NPrint "Artist           : ", id3_GetTagString{#ID3Tag_Artist     ,"n/a"}
  NPrint "Album            : ", id3_GetTagString{#ID3Tag_Album      ,"n/q"}
  NPrint "Year             : ", id3_GetTagString{#ID3Tag_Year       ,"n/a"}
  NPrint "Comment          : ", id3_GetTagString{#ID3Tag_Comment    ,"n/a"}
  NPrint "Genre            : ", id3_GetTagString{#ID3Tag_Genre      ,"n/a"}
  NPrint "Comment2         : ", id3_GetTagString{#ID3Tag_Comment2   ,"n/a"}
  NPrint "Artist URL       : ", id3_GetTagString{#ID3Tag_URLArtist  ,"n/a"}
  NPrint "Audifile URL     : ", id3_GetTagString{#ID3Tag_URLAudiofile,"n/a"}
  NPrint "LyricsText       : ", id3_GetTagString{#ID3Tag_LyricsText ,"n/a"}
  NPrint "Language         : ", id3_GetTagString{#ID3Tag_LyricsLanguage,"n/a"}
  NPrint "Publisher        : ", id3_GetTagString{#ID3Tag_Publisher  ,"n/a"}
  NPrint "Copyright        : ", id3_GetTagString{#ID3Tag_Copyright  ,"n/a"}
  NPrint "Img Other        : ", id3_GetTagImageInfo{#ID3Tag_ImageOther     ,"n/a"}
  NPrint "Img CoverFront   : ", id3_GetTagImageInfo{#ID3Tag_ImageCoverFront,"n/a"}
  NPrint "Img CoverBack    : ", id3_GetTagImageInfo{#ID3Tag_ImageCoverBack ,"n/a"}
  NPrint "Img leaflet      : ", id3_GetTagImageInfo{#ID3Tag_ImageLeaflet   ,"n/a"}
  NPrint "Img Media        : ", id3_GetTagImageInfo{#ID3Tag_ImageMedia     ,"n/a"}
  NPrint "Img LoadArtist   : ", id3_GetTagImageInfo{#ID3Tag_ImageLeadArtist,"n/a"}
  NPrint "Img Artist       : ", id3_GetTagImageInfo{#ID3Tag_ImageArtist    ,"n/a"}
  NPrint "Img Conductor    : ", id3_GetTagImageInfo{#ID3Tag_ImageConductor ,"n/a"}
  NPrint "Img Band         : ", id3_GetTagImageInfo{#ID3Tag_ImageBand      ,"n/a"}
  NPrint "Img Composer     : ", id3_GetTagImageInfo{#ID3Tag_ImageComposer  ,"n/a"}
  NPrint "Img TW           : ", id3_GetTagImageInfo{#ID3Tag_ImageTextWriter,"n/a"}
  NPrint "Img RecLock      : ", id3_GetTagImageInfo{#ID3Tag_ImageRecordingLocation,"n/a"}
  NPrint "Img Movie        : ", id3_GetTagImageInfo{#ID3Tag_ImageMovie     ,"n/a"}
  NPrint "Img Logo         : ", id3_GetTagImageInfo{#ID3Tag_ImageLogo      ,"n/a"}
  NPrint "Img Illustration : ", id3_GetTagImageInfo{#ID3Tag_ImageIllustration,"n/a"}
  NPrint "Track  #         : ", id3_GetTagValue{#ID3Tag_Track ,-1}
  NPrint "Track2 #         : ", id3_GetTagValue{#ID3Tag_Track2,-1}
  NPrint "BPM              : ", id3_GetTagValue{#ID3Tag_BPM   ,-1}
Else
  NPrint "ERROR: No ID3 Tags found in file \\22"+a.s+"\\22!"
End If
End
CEND

