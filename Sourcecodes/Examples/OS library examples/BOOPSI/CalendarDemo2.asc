WBStartup

XINCLUDE "blitz2:includes/calendar.gadget.bb2"

*lib.Library = OpenLibrary_("libs:gadgets/calendar.gadget",0)

If *lib = 0
 Request "Error","calendar.Gadget not found !","Ok"
 End
EndIf

*lpub._Screen = LockPubScreen_(0)
If *lpub
 *dri.DrawInfo = GetScreenDrawInfo_(*lpub)
 If *dri
  mw = ((*lpub\_RastPort\TxWidth*3)*7)+(6 * 2)
  mh = (*lpub\_RastPort\TxHeight*7)+(6 * 1)
  w = Max(320,mw)
  h = Max(100,mh)

Dim wintags.TagItem(20)
 wintags(0)\ti_Tag  = #WA_Left         ,(*lpub\Width/2)-w / 2
 wintags(1)\ti_Tag  = #WA_Top          ,(*lpub\Height/2)-w / 2
 wintags(2)\ti_Tag  = #WA_InnerWidth   ,w + 4
 wintags(3)\ti_Tag  = #WA_InnerHeight  ,h + 2
 wintags(4)\ti_Tag  = #WA_CloseGadget  ,1
 wintags(5)\ti_Tag  = #WA_DepthGadget  ,1
 wintags(6)\ti_Tag  = #WA_SizeGadget   ,1
 wintags(7)\ti_Tag  = #WA_DragBar      ,1
 wintags(8)\ti_Tag  = #WA_SimpleRefresh,1
 wintags(9)\ti_Tag  = #WA_NoCareRefresh,1
 wintags(10)\ti_Tag = #WA_SizeBBottom  ,1
 wintags(11)\ti_Tag = #WA_Activate     ,1
 wintags(12)\ti_Tag = #WA_MinWidth     ,8 + 4 + mw
 wintags(13)\ti_Tag = #WA_MinHeight    ,*lpub\BarHeight + 10 + 2 + mh
 wintags(14)\ti_Tag = #WA_MaxWidth     ,1024
 wintags(15)\ti_Tag = #WA_MaxHeight    ,1024
 wintags(16)\ti_Tag = #WA_AutoAdjust   ,1
 wintags(17)\ti_Tag = #WA_Title        ,Null("Calendar.gadget")
 wintags(18)\ti_Tag = #WA_IDCMP        ,#IDCMP_CLOSEWINDOW|#IDCMP_GADGETUP|#IDCMP_REFRESHWINDOW
 wintags(19)\ti_Tag = #TAG_END         ,0

*win._Window = OpenWindowTagList_(0,&wintags(0))
If *win
DEFTYPE.Gadget *gad1

Restore daynames
Dim day$(6)
 For z=0 To 6
 Read text$
 day$(t)=text$
 Next z

Dim gadtags.TagItem(13)
 gadtags(0)\ti_Tag  = #GA_Left              ,*win\BorderLeft + 2
 gadtags(1)\ti_Tag  = #GA_Top               ,*win\BorderTop + 1
 gadtags(2)\ti_Tag  = #GA_RelWidth          ,*win\BorderRight-20
 gadtags(3)\ti_Tag  = #GA_RelHeight         ,*win\BorderBottom-35
 gadtags(4)\ti_Tag  = #GA_RelVerify         ,1
 gadtags(5)\ti_Tag  = #GA_ID                ,1
 gadtags(6)\ti_Tag  = #GA_Immediate         ,1
 gadtags(7)\ti_Tag  = #CALENDAR_Label       ,1
 gadtags(8)\ti_Tag  = #CALENDAR_Labels      ,0
 gadtags(9)\ti_Tag  = #CALENDAR_Day         ,day$(0)
 gadtags(10)\ti_Tag = #CALENDAR_FirstWeekDay,1
 gadtags(11)\ti_Tag = #ICA_TARGET           ,#ICTARGET_IDCMP
 gadtags(12)\ti_Tag = #TAG_END              ,0

*gad1 = NewObjectA_(0,"calendar.gadget",&gadtags(0))

AddGList_ *win,*gad1,0,0,0
RefreshGList_ *gad1,*win,0,0

DEFTYPE.IntuiMessage *imsg

loop=1
 While loop
  WaitPort_ *win\UserPort
   *imsg=GetMsg_(*win\UserPort)
   *class = *imsg\Class
     ReplyMsg_ *imsg

 Select *class
  Case #IDCMP_CLOSEWINDOW
  loop=0
 End Select
 Wend

 DisposeObject_ *gad1
 FreeScreenDrawInfo_ *lpub,*dri
 CloseWindow_ *win
 UnlockPubScreen_ 0,*lpub
 CloseLibrary_ *lib
 FreeVec_ labs
 EndIf:EndIf:EndIf
End

daynames:
Data$ "Sun","Mon","Tue","Wed","Thu","Fri","Sat"
